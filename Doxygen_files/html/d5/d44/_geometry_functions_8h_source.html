<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KratosMultiphysics: /software/kratos/doxygen/applications/DEMApplication/custom_utilities/GeometryFunctions.h Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../kratos_small.png"/></td>
  <td id="projectalign">
   <div id="projectname">KratosMultiphysics
   </div>
   <div id="projectbrief">KRATOS Multiphysics (Kratos) is a framework for building parallel, multi-disciplinary simulation software, aiming at modularity, extensibility, and high performance. Kratos is written in C++, and counts with an extensive Python interface.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_a6e4fee11f07c3b70486e88fe92cbbdc.html">applications</a></li><li class="navelem"><a class="el" href="../../dir_6ab3994ab2642c0f95d1ba2c2ee6bced.html">DEMApplication</a></li><li class="navelem"><a class="el" href="../../dir_d867383ea16c8bcbbbc3fbb9aedd08af.html">custom_utilities</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">GeometryFunctions.h</div></div>
</div><!--header-->
<div class="contents">
<a href="../../d5/d44/_geometry_functions_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment"> * File:   GeometryFunctions.h</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"> * Author: msantasusana, Chun Feng</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment"> *</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"> * Created on 21 de mayo de 2012, 19:40</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"> */</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span> </div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="preprocessor">#ifndef _GEOMETRYFUNCTIONS_H</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="preprocessor">#define _GEOMETRYFUNCTIONS_H</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span> </div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="preprocessor">#include &quot;<a class="code" href="../../d1/db8/openmp__utils_8h.html">utilities/openmp_utils.h</a>&quot;</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#include &quot;<a class="code" href="../../da/d07/quaternion_8h.html">utilities/quaternion.h</a>&quot;</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor">#include &quot;<a class="code" href="../../dd/dfe/model__part_8h.html">includes/model_part.h</a>&quot;</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#include &quot;<a class="code" href="../../d9/d06/_d_e_m__application__variables_8h.html">DEM_application_variables.h</a>&quot;</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span> </div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="keyword">namespace </span><a class="code hl_namespace" href="../../db/d66/namespace_kratos.html">Kratos</a> {</div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span> </div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html">   19</a></span>    <span class="keyword">namespace </span>GeometryFunctions {</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span> </div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ac071c0e9b1a2de8fbb26df2ef5eee343">   21</a></span>    <span class="keyword">typedef</span> <a class="code hl_class" href="../../dc/dea/class_kratos_1_1_geometry.html">Geometry&lt;Node &lt; 3 &gt;</a> &gt; <a class="code hl_typedef" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ac071c0e9b1a2de8fbb26df2ef5eee343">GeometryType</a>;</div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span> </div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a3328e346ff8765552b131f7447f6e6f2">   23</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a3328e346ff8765552b131f7447f6e6f2">RotateAVectorAGivenAngleAroundAUnitaryVector</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; old_vec, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; axis,</div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span>                                                                    <span class="keyword">const</span> <span class="keywordtype">double</span> ang, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; new_vec) {</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>        <span class="keywordtype">double</span> cang = std::cos(ang);</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>        <span class="keywordtype">double</span> sang = std::sin(ang);</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span> </div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>        new_vec[0] = axis[0] * (axis[0] * old_vec[0] + axis[1] * old_vec[1] + axis[2] * old_vec[2]) * (1 - cang) + old_vec[0] * cang + (-axis[2] * old_vec[1] + axis[1] * old_vec[2]) * sang;</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>        new_vec[1] = axis[1] * (axis[0] * old_vec[0] + axis[1] * old_vec[1] + axis[2] * old_vec[2]) * (1 - cang) + old_vec[1] * cang + ( axis[2] * old_vec[0] - axis[0] * old_vec[2]) * sang;</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>        new_vec[2] = axis[2] * (axis[0] * old_vec[0] + axis[1] * old_vec[1] + axis[2] * old_vec[2]) * (1 - cang) + old_vec[2] * cang + (-axis[1] * old_vec[0] + axis[0] * old_vec[1]) * sang;</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>    }</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span> </div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a796e36ac46bfa5ddff527edfe68a98ef">   33</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a796e36ac46bfa5ddff527edfe68a98ef">TranslateGridOfNodes</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> time, <span class="keyword">const</span> <span class="keywordtype">double</span> velocity_start_time, <span class="keyword">const</span> <span class="keywordtype">double</span> velocity_stop_time, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; center_position,</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>                                            <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; initial_center, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; previous_displ, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; linear_velocity_changed,</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>                                            <span class="keyword">const</span> <span class="keywordtype">double</span> linear_period, <span class="keyword">const</span> <span class="keywordtype">double</span> dt, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; linear_velocity) {</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span> </div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>        <span class="keywordflow">if</span> (time &lt; velocity_start_time || time &gt; velocity_stop_time) {</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>            center_position[0] = initial_center[0] + previous_displ[0];</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>            center_position[1] = initial_center[1] + previous_displ[1];</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>            center_position[2] = initial_center[2] + previous_displ[2];</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>            linear_velocity_changed = <a class="code hl_typedef" href="../../db/d66/namespace_kratos.html#a0060702fbd6c7d45c773436101c9ded3">ZeroVector</a>(3);</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>            <span class="keywordflow">if</span> (linear_period &gt; 0.0) {</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>                <span class="keywordtype">double</span> linear_omega = 2.0 * <a class="code hl_variable" href="../../d5/dc0/namespace_kratos_1_1_globals.html#ae57da311aaf349aa883363f673e534fc">Globals::Pi</a> / linear_period;</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>                <span class="keywordtype">double</span> inv_linear_omega = 1.0 / linear_omega;</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>                <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(center_position) = initial_center + linear_velocity * std::sin(linear_omega * (time - velocity_start_time)) * inv_linear_omega;</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>                <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(linear_velocity_changed) = linear_velocity * std::cos(linear_omega * (time - velocity_start_time));</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>                <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(previous_displ) = center_position - initial_center;</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>                center_position[0] = initial_center[0] + previous_displ[0] + dt * linear_velocity[0];</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>                center_position[1] = initial_center[1] + previous_displ[1] + dt * linear_velocity[1];</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>                center_position[2] = initial_center[2] + previous_displ[2] + dt * linear_velocity[2];</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>                previous_displ[0] += dt * linear_velocity[0];</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>                previous_displ[1] += dt * linear_velocity[1];</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>                previous_displ[2] += dt * linear_velocity[2];</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>                linear_velocity_changed = linear_velocity;</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>            }</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>        }</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>    }</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span> </div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab96a3d6816e74ff6294db25421a7ddb8">   61</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab96a3d6816e74ff6294db25421a7ddb8">sign</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> a)</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>    {</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>        <span class="keywordflow">return</span> (0.0 &lt; a) - (a &lt; 0.0);</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>        <span class="comment">/*int output;</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span><span class="comment">        if (a &lt; 0.0) output = -1;</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span><span class="comment">        else if (a &gt; 0.0) output = 1;</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span><span class="comment">        else output = 0;</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span><span class="comment">        return output;*/</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>    }</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span> </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afb4178f7aa038bd0ed82d2a4b3bf4906">   71</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afb4178f7aa038bd0ed82d2a4b3bf4906">min</a>(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b)</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>    {</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>        <span class="keywordtype">double</span> output;</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>        <span class="keywordflow">if</span> (a&lt;=b) output = a;</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>        <span class="keywordflow">else</span> output = b;</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>        <span class="keywordflow">return</span> output;</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>    }</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span> </div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a819e51c089a0d603f13c6ce87e7cbed5">   79</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a819e51c089a0d603f13c6ce87e7cbed5">max</a>(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b)</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>    {</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>        <span class="keywordtype">double</span> output;</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>        <span class="keywordflow">if</span> (a&gt;=b) output = a;</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>        <span class="keywordflow">else</span> output = b;</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>        <span class="keywordflow">return</span> output;</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>    }</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span> </div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">   87</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>(<span class="keywordtype">double</span> <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[3])</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>    {</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>            <span class="keywordtype">double</span> distance = <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a963d27657c723d4127e779af7cd0d952">DEM_INNER_PRODUCT_3</a>(<a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>, <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>);</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>            <span class="keywordtype">double</span> inv_distance = (distance &gt; 0.0) ?  1.0 / sqrt(distance) : 0.00;</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span> </div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>            <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[0] = <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[0] * inv_distance;</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>            <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[1] = <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[1] * inv_distance;</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>            <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[2] = <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[2] * inv_distance;</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    }</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span> </div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#af953994c0c8824286fa30dd980e721e7">   97</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>(<a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>, <span class="keywordtype">double</span>&amp; distance)</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    {</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>            distance = <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a33d81a3e79bb06d94c0d6b7ceb3b4c05">DEM_MODULUS_3</a>(<a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>);</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>            <span class="keywordtype">double</span> inv_distance = (distance != 0.0) ?  1.0 / distance : 0.00;</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span> </div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>            <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[0] = <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[0] * inv_distance;</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>            <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[1] = <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[1] * inv_distance;</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>            <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[2] = <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[2] * inv_distance;</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>    }</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span> </div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a33344aefdf89c2bbf8bd33cb35506fdf">  107</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>(<span class="keywordtype">double</span> <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[3], <span class="keywordtype">double</span>&amp; distance)</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    {</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>            distance = <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a33d81a3e79bb06d94c0d6b7ceb3b4c05">DEM_MODULUS_3</a>(<a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>);</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>            <span class="keywordtype">double</span> inv_distance = (distance != 0.0) ?  1.0 / distance : 0.00;</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span> </div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>            <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[0] = <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[0] * inv_distance;</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>            <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[1] = <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[1] * inv_distance;</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>            <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[2] = <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[2] * inv_distance;</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    }</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span> </div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a47b0cc47c5f7b31a77b10141df5b3b83">  117</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>(<a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>)</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    {</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>            <span class="keywordtype">double</span> distance = <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a33d81a3e79bb06d94c0d6b7ceb3b4c05">DEM_MODULUS_3</a>(<a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>);</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>            <span class="keywordtype">double</span> inv_distance = (distance != 0.0) ?  1.0 / distance : 0.00;</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span> </div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>            <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[0] = <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[0] * inv_distance;</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>            <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[1] = <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[1] * inv_distance;</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>            <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[2] = <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[2] * inv_distance;</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    }</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span> </div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a44c5245fc1c0b5505bb15b31a705d8ff">  127</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a44c5245fc1c0b5505bb15b31a705d8ff">module</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>, <span class="keywordtype">double</span>&amp; distance)</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>    {</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>            distance = <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a33d81a3e79bb06d94c0d6b7ceb3b4c05">DEM_MODULUS_3</a>(<a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>);</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>    }</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span> </div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a9632578768334a6090df378675cc1787">  132</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a44c5245fc1c0b5505bb15b31a705d8ff">module</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[3])</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    {</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a33d81a3e79bb06d94c0d6b7ceb3b4c05">DEM_MODULUS_3</a>(<a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>);</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    }</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span> </div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ac217653765d640c583464973d6fcdbd5">  137</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a44c5245fc1c0b5505bb15b31a705d8ff">module</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>[3], <span class="keywordtype">double</span>&amp; distance)</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    {</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>            distance = <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a33d81a3e79bb06d94c0d6b7ceb3b4c05">DEM_MODULUS_3</a>(<a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>);</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    }</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span> </div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aa805cdf40c79122f8f12a5b7e3607afe">  142</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a44c5245fc1c0b5505bb15b31a705d8ff">module</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>)</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    {</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>            <span class="keywordtype">double</span> distance = <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a33d81a3e79bb06d94c0d6b7ceb3b4c05">DEM_MODULUS_3</a>(<a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Vector</a>);</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>            <span class="keywordflow">return</span> distance;</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    }</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span> </div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afcfb83ddbb3c0ece824748b9b2e1c7fa">  148</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afcfb83ddbb3c0ece824748b9b2e1c7fa">VectorGlobal2Local</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> LocalCoordSystem[3][3], <span class="keyword">const</span> <span class="keywordtype">double</span> GlobalVector[3], <span class="keywordtype">double</span> LocalVector[3])</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    {</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;3; i++) {</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>            LocalVector[i] = 0.0;</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;3; j++) {</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>                LocalVector[i]+=LocalCoordSystem[i][j]*GlobalVector[j];</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>            }</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>        }</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    }</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span> </div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a17002b9a527354a22b084f3e08dfe433">  158</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afcfb83ddbb3c0ece824748b9b2e1c7fa">VectorGlobal2Local</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> LocalCoordSystem[3][3], <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; GlobalVector, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; LocalVector)</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>    {</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;3; i++) {</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>            LocalVector[i] = 0.0;</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;3; j++) {</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>                LocalVector[i]+=LocalCoordSystem[i][j]*GlobalVector[j];</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>            }</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>        }</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    }</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span> </div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aa3eabc939222f9229e0b79627e6eb16e">  168</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afcfb83ddbb3c0ece824748b9b2e1c7fa">VectorGlobal2Local</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> LocalCoordSystem[3][3], <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; GlobalVector, <span class="keywordtype">double</span> LocalVector[3])</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    {</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;3; i++) {</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>            LocalVector[i] = 0.0;</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;3; j++) {</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>                LocalVector[i]+=LocalCoordSystem[i][j]*GlobalVector[j];</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>            }</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>        }</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>    }</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span> </div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a1e040cca465a7040da307e031155e3c3">  178</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a1e040cca465a7040da307e031155e3c3">VectorLocal2Global</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> LocalCoordSystem[3][3], <span class="keyword">const</span> <span class="keywordtype">double</span> LocalVector[3], <span class="keywordtype">double</span> GlobalVector[3])</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    {</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;3; i++) {</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>            GlobalVector[i] = 0.0;</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;3; j++) {</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>                GlobalVector[i]+=LocalCoordSystem[j][i]*LocalVector[j];</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>            }</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>        }</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>    }</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span> </div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a2a9a743a9b8204a538dd91f3e04dfde0">  188</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a1e040cca465a7040da307e031155e3c3">VectorLocal2Global</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> LocalCoordSystem[3][3], <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; LocalVector, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; GlobalVector)</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>    {</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;3; i++) {</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>            GlobalVector[i] = 0.0;</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;3; j++) {</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>                GlobalVector[i]+=LocalCoordSystem[j][i]*LocalVector[j];</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>            }</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>        }</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    }</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span> </div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#abcca69c07518edebeed12d660c01ccac">  198</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a1e040cca465a7040da307e031155e3c3">VectorLocal2Global</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> LocalCoordSystem[3][3], <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; LocalVector, <span class="keywordtype">double</span> GlobalVector[3])</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>    {</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;3; i++) {</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>            GlobalVector[i] = 0.0;</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;3; j++) {</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>                GlobalVector[i]+=LocalCoordSystem[j][i]*LocalVector[j];</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>            }</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>        }</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    }</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span> </div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a12366d7e127881330c93b20de0542b75">  208</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a1e040cca465a7040da307e031155e3c3">VectorLocal2Global</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> LocalCoordSystem[3][3], <span class="keyword">const</span> <span class="keywordtype">double</span> LocalVector[3], <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; GlobalVector)</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    {</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;3; i++) {</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>            GlobalVector[i] = 0.0;</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;3; j++) {</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>                GlobalVector[i]+=LocalCoordSystem[j][i]*LocalVector[j];</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>            }</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>        }</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>    }</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span> </div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ac7f99de1af66b26805e3b597d98623ab">  218</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ac7f99de1af66b26805e3b597d98623ab">ProductMatrices3X3</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> Matrix1[3][3], <span class="keyword">const</span> <span class="keywordtype">double</span> Matrix2[3][3], <span class="keywordtype">double</span> Matrix3[3][3])</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    {</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) {</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) {</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>                Matrix3[i][j] = 0.0;</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; k++) {</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>                    Matrix3[i][j] += Matrix1[i][k] * Matrix2[k][j];</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>                }</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>            }</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>        }</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>    }</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span> </div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a746a9464281ea36e250dd638fe0bb1fb">  230</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a746a9464281ea36e250dd638fe0bb1fb">ProductMatrix3X3Vector3X1</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Matrix</a>[3][3], <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; Vector1, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; Vector2)</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>    {</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;3; i++) {</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>            Vector2[i] = 0.0;</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;3; j++) {</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>                Vector2[i]+=<a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Matrix</a>[j][i]*Vector1[j];</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>            }</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>        }</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>    }</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span> </div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ac1deb53a9a7d842899da0a23c8efdf65">  240</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ac1deb53a9a7d842899da0a23c8efdf65">TensorGlobal2Local</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> LocalCoordSystem[3][3], <span class="keyword">const</span> <span class="keywordtype">double</span> GlobalTensor[3][3], <span class="keywordtype">double</span> LocalTensor[3][3])</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    {</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>        <span class="comment">// We will compute LocalTensor = LocalCoordSystem * GlobalTensor * transposed(LocalCoordSystem)</span></div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>        <span class="comment">// starting on the left, so we will first compute the product TemporalResult = LocalCoordSystem * GlobalTensor</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>        <span class="comment">// and afterwards TemporalResult * transposed(LocalCoordSystem), which will give the value of the tensor LocalTensor</span></div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span> </div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>        <span class="keywordtype">double</span> TransposedLocalCoordSystem[3][3];</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>        <span class="keywordtype">double</span> TemporalResult[3][3];</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span> </div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>        TransposedLocalCoordSystem[0][0] = LocalCoordSystem[0][0]; TransposedLocalCoordSystem[0][1] = LocalCoordSystem[1][0]; TransposedLocalCoordSystem[0][2] = LocalCoordSystem[2][0];</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>        TransposedLocalCoordSystem[1][0] = LocalCoordSystem[0][1]; TransposedLocalCoordSystem[1][1] = LocalCoordSystem[1][1]; TransposedLocalCoordSystem[1][2] = LocalCoordSystem[2][1];</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>        TransposedLocalCoordSystem[2][0] = LocalCoordSystem[0][2]; TransposedLocalCoordSystem[2][1] = LocalCoordSystem[1][2]; TransposedLocalCoordSystem[2][2] = LocalCoordSystem[2][2];</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ac7f99de1af66b26805e3b597d98623ab">ProductMatrices3X3</a>(LocalCoordSystem, GlobalTensor, TemporalResult);</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ac7f99de1af66b26805e3b597d98623ab">ProductMatrices3X3</a>(TemporalResult, TransposedLocalCoordSystem, LocalTensor);</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>    }</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span> </div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a6a0b41cecc5d952cbfe4b0625b0f2d62">  257</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a6a0b41cecc5d952cbfe4b0625b0f2d62">TensorLocal2Global</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> LocalCoordSystem[3][3], <span class="keyword">const</span> <span class="keywordtype">double</span> LocalTensor[3][3], <span class="keywordtype">double</span> GlobalTensor[3][3])</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>    {</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>        <span class="comment">// We will compute GlobalTensor = transposed(LocalCoordSystem) * LocalTensor * LocalCoordSystem</span></div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>        <span class="comment">// starting on the left, so we will first compute the product TemporalResult = transposed(LocalCoordSystem) * LocalTensor</span></div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>        <span class="comment">// and afterwards TemporalResult * LocalCoordSystem, which will give the value of the tensor LocalTensor</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span> </div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>        <span class="keywordtype">double</span> TransposedLocalCoordSystem[3][3];</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>        <span class="keywordtype">double</span> TemporalResult[3][3];</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span> </div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>        TransposedLocalCoordSystem[0][0] = LocalCoordSystem[0][0]; TransposedLocalCoordSystem[0][1] = LocalCoordSystem[1][0]; TransposedLocalCoordSystem[0][2] = LocalCoordSystem[2][0];</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>        TransposedLocalCoordSystem[1][0] = LocalCoordSystem[0][1]; TransposedLocalCoordSystem[1][1] = LocalCoordSystem[1][1]; TransposedLocalCoordSystem[1][2] = LocalCoordSystem[2][1];</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>        TransposedLocalCoordSystem[2][0] = LocalCoordSystem[0][2]; TransposedLocalCoordSystem[2][1] = LocalCoordSystem[1][2]; TransposedLocalCoordSystem[2][2] = LocalCoordSystem[2][2];</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span> </div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ac7f99de1af66b26805e3b597d98623ab">ProductMatrices3X3</a>(TransposedLocalCoordSystem, LocalTensor, TemporalResult);</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ac7f99de1af66b26805e3b597d98623ab">ProductMatrices3X3</a>(TemporalResult, LocalCoordSystem, GlobalTensor);</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>    }</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span> </div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a1dc452646721c6a9d6cd91f3279a56ae">  274</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a1dc452646721c6a9d6cd91f3279a56ae">RotaMatrixTensorLocal2Global</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> R[3][3], <span class="keyword">const</span> <span class="keywordtype">double</span> LocalTensor[3][3], <span class="keywordtype">double</span> GlobalTensor[3][3])</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>    {</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>        <span class="keywordtype">double</span> RT[3][3]; <span class="keywordtype">double</span> Temp[3][3];</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span> </div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>        RT[0][0] = R[0][0]; RT[0][1] = R[1][0]; RT[0][2] = R[2][0];</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>        RT[1][0] = R[0][1]; RT[1][1] = R[1][1]; RT[1][2] = R[2][1];</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>        RT[2][0] = R[0][2]; RT[2][1] = R[1][2]; RT[2][2] = R[2][2];</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span> </div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ac7f99de1af66b26805e3b597d98623ab">ProductMatrices3X3</a>(R, LocalTensor, Temp);</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ac7f99de1af66b26805e3b597d98623ab">ProductMatrices3X3</a>(Temp, RT, GlobalTensor);</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>    }</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span> </div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aaa04a5353a4697694bd0bbaa3a0a6e67">  286</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aaa04a5353a4697694bd0bbaa3a0a6e67">ConstructLocalTensor</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> moment_of_inertia, <span class="keywordtype">double</span> LocalTensor[3][3])</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>    {</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>        LocalTensor[0][0] = moment_of_inertia; LocalTensor[0][1] = 0.0; LocalTensor[0][2] = 0.0;</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>        LocalTensor[1][0] = 0.0; LocalTensor[1][1] = moment_of_inertia; LocalTensor[1][2] = 0.0;</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>        LocalTensor[2][0] = 0.0; LocalTensor[2][1] = 0.0; LocalTensor[2][2] = moment_of_inertia;</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>    }</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span> </div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a2f195913327f033e2118653b380b157a">  293</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a2f195913327f033e2118653b380b157a">ConstructInvLocalTensor</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> moment_of_inertia, <span class="keywordtype">double</span> LocalTensorInv[3][3])</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>    {</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>        <span class="keywordtype">double</span> moment_of_inertia_inv = 1/moment_of_inertia;</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>        LocalTensorInv[0][0] = moment_of_inertia_inv; LocalTensorInv[0][1] = 0.0; LocalTensorInv[0][2] = 0.0;</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>        LocalTensorInv[1][0] = 0.0; LocalTensorInv[1][1] = moment_of_inertia_inv; LocalTensorInv[1][2] = 0.0;</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>        LocalTensorInv[2][0] = 0.0; LocalTensorInv[2][1] = 0.0; LocalTensorInv[2][2] = moment_of_inertia_inv;</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>    }</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span> </div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a47eb735a1029f7fafa1fa3d140ae171c">  301</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aaa04a5353a4697694bd0bbaa3a0a6e67">ConstructLocalTensor</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3 &gt;</a>&amp; moments_of_inertia, <span class="keywordtype">double</span> LocalTensor[3][3])</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>    {</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>        LocalTensor[0][0] = moments_of_inertia[0]; LocalTensor[0][1] = 0.0; LocalTensor[0][2] = 0.0;</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>        LocalTensor[1][0] = 0.0; LocalTensor[1][1] = moments_of_inertia[1]; LocalTensor[1][2] = 0.0;</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>        LocalTensor[2][0] = 0.0; LocalTensor[2][1] = 0.0; LocalTensor[2][2] = moments_of_inertia[2];</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>    }</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span> </div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a5fa3fca23a7d8539ea74fe686228414d">  308</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a2f195913327f033e2118653b380b157a">ConstructInvLocalTensor</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3 &gt;</a>&amp; moments_of_inertia, <span class="keywordtype">double</span> LocalTensorInv[3][3])</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>    {</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>        LocalTensorInv[0][0] = 1/moments_of_inertia[0]; LocalTensorInv[0][1] = 0.0; LocalTensorInv[0][2] = 0.0;</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>        LocalTensorInv[1][0] = 0.0; LocalTensorInv[1][1] = 1/moments_of_inertia[1]; LocalTensorInv[1][2] = 0.0;</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>        LocalTensorInv[2][0] = 0.0; LocalTensorInv[2][1] = 0.0; LocalTensorInv[2][2] = 1/moments_of_inertia[2];</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>    }</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span> </div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae3bbd7194a2ffdee9412e5b3ad716e26">  315</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae3bbd7194a2ffdee9412e5b3ad716e26">DotProduct</a>(<span class="keywordtype">double</span> Vector1[3], <span class="keywordtype">double</span> Vector2[3])</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>    {</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>        <span class="keywordflow">return</span> Vector1[0] * Vector2[0] + Vector1[1] * Vector2[1] + Vector1[2] * Vector2[2];</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>    }</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span> </div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a62dab46df07e77de17edadc203fc4bc8">  320</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae3bbd7194a2ffdee9412e5b3ad716e26">DotProduct</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; Vector1, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; Vector2)</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>    {</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>        <span class="keywordflow">return</span> Vector1[0] * Vector2[0] + Vector1[1] * Vector2[1] + Vector1[2] * Vector2[2];</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>    }</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span> </div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">  325</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">CrossProduct</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> u[3], <span class="keyword">const</span> <span class="keywordtype">double</span> v[3], <span class="keywordtype">double</span> ReturnVector[3])</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>    {</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>        ReturnVector[0] = u[1]*v[2] - u[2]*v[1];</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>        ReturnVector[1] = v[0]*u[2] - u[0]*v[2];</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>        ReturnVector[2] = u[0]*v[1] - u[1]*v[0];</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>    }</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span> </div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a8a03c7a5df6c503c980017aa7f825c82">  332</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">CrossProduct</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; u, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; v, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; ReturnVector)</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>    {</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>        ReturnVector[0] = u[1]*v[2] - u[2]*v[1];</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>        ReturnVector[1] = v[0]*u[2] - u[0]*v[2];</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>        ReturnVector[2] = u[0]*v[1] - u[1]*v[0];</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>    }</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span> </div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a95bf121929092e71f447a74d642e96ff">  339</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">CrossProduct</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> u[3], <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; v, <span class="keywordtype">double</span> ReturnVector[3])</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>    {</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>        ReturnVector[0] = u[1]*v[2] - u[2]*v[1];</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>        ReturnVector[1] = v[0]*u[2] - u[0]*v[2];</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>        ReturnVector[2] = u[0]*v[1] - u[1]*v[0];</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>    }</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span> </div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a8f45fb3eae6828e89f9c5d50b7aa804c">  346</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">CrossProduct</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; u, <span class="keyword">const</span> <span class="keywordtype">double</span> v[3], <span class="keywordtype">double</span> ReturnVector[3])</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>    {</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>        ReturnVector[0] = u[1]*v[2] - u[2]*v[1];</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>        ReturnVector[1] = v[0]*u[2] - u[0]*v[2];</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>        ReturnVector[2] = u[0]*v[1] - u[1]*v[0];</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>    }</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span> </div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a7f42010a653865453225d6a6bf589b69">  353</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">CrossProduct</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; u, <span class="keyword">const</span> <span class="keywordtype">double</span> v[3], <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; ReturnVector)</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    {</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>        ReturnVector[0] = u[1]*v[2] - u[2]*v[1];</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>        ReturnVector[1] = v[0]*u[2] - u[0]*v[2];</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>        ReturnVector[2] = u[0]*v[1] - u[1]*v[0];</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>    }</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span> </div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a21784d5f3a9e1b7b89710c1b5d1c92ba">  360</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">CrossProduct</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; u, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; v, <span class="keywordtype">double</span> ReturnVector[3])</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>    {</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>        ReturnVector[0] = u[1]*v[2] - u[2]*v[1];</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>        ReturnVector[1] = v[0]*u[2] - u[0]*v[2];</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>        ReturnVector[2] = u[0]*v[1] - u[1]*v[0];</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>    }</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span> </div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a2658e0a68e9d374ec08c496099bda9f9">  367</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a2658e0a68e9d374ec08c496099bda9f9">RotateRightHandedBasisAroundAxis</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; e1,  <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; e2,  <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; axis,</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>                                                        <span class="keyword">const</span> <span class="keywordtype">double</span> ang, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; new_axes1, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; new_axes2,</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>                                                        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; new_axes3) {</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span> </div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a3328e346ff8765552b131f7447f6e6f2">RotateAVectorAGivenAngleAroundAUnitaryVector</a>(e1, axis, ang, new_axes1);</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span> </div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a3328e346ff8765552b131f7447f6e6f2">RotateAVectorAGivenAngleAroundAUnitaryVector</a>(e2, axis, ang, new_axes2);</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span> </div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">CrossProduct</a>(new_axes1, new_axes2, new_axes3);</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>    }</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span> </div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#acc99621a8dbda7d46b34669511883258">  378</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#acc99621a8dbda7d46b34669511883258">RotateGridOfNodes</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> time, <span class="keyword">const</span> <span class="keywordtype">double</span> angular_velocity_start_time, <span class="keyword">const</span> <span class="keywordtype">double</span> angular_velocity_stop_time,</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>                                         <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; angular_velocity_changed, <span class="keyword">const</span> <span class="keywordtype">double</span> angular_period, <span class="keyword">const</span> <span class="keywordtype">double</span> mod_angular_velocity,</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>                                         <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; angular_velocity, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; new_axes1, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; new_axes2,</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>                                         <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; new_axes3) {</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span> </div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> angle;</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>        <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(angle) = <a class="code hl_typedef" href="../../db/d66/namespace_kratos.html#a0060702fbd6c7d45c773436101c9ded3">ZeroVector</a>(3);</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>        <span class="keywordtype">double</span> sign_angle = 1.0;</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> final_angle = <a class="code hl_typedef" href="../../db/d66/namespace_kratos.html#a0060702fbd6c7d45c773436101c9ded3">ZeroVector</a>(3);</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span> </div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>        <span class="keywordflow">if</span> (time &lt; angular_velocity_start_time) angular_velocity_changed = <a class="code hl_typedef" href="../../db/d66/namespace_kratos.html#a0060702fbd6c7d45c773436101c9ded3">ZeroVector</a>(3);</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span> </div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((time - angular_velocity_start_time) &gt; 0.0) &amp;&amp; ((time - angular_velocity_stop_time) &lt; 0.0)) {</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span> </div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>            <span class="keywordflow">if</span> (angular_period &gt; 0.0) {</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>                <span class="keywordtype">double</span> angular_omega = 2.0 * <a class="code hl_variable" href="../../d5/dc0/namespace_kratos_1_1_globals.html#ae57da311aaf349aa883363f673e534fc">Globals::Pi</a> / angular_period;</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>                <span class="keywordtype">double</span> inv_angular_omega = 1.0 / angular_omega;</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>                <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(angle) = angular_velocity * std::sin(angular_omega * (time - angular_velocity_start_time)) * inv_angular_omega;</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>                sign_angle = std::sin(angular_omega * (time - angular_velocity_start_time)) / fabs(sin(angular_omega * (time - angular_velocity_start_time)));</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>                <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(angular_velocity_changed) = angular_velocity * std::cos(angular_omega * (time - angular_velocity_start_time));</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>                <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(final_angle) = angle;</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>                <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(angle) = angular_velocity * (time - angular_velocity_start_time);</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>                <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(angular_velocity_changed) = angular_velocity;</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>            }</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>        } <span class="keywordflow">else</span> { <span class="comment">//if ((time - angular_velocity_stop_time) &gt; 0.0) {</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>            <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(angular_velocity_changed) = <a class="code hl_typedef" href="../../db/d66/namespace_kratos.html#a0060702fbd6c7d45c773436101c9ded3">ZeroVector</a>(3);</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span> </div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>            <span class="keywordflow">if</span> (angular_period &gt; 0.0) {</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>                <span class="keywordtype">double</span> angular_omega = 2.0 * <a class="code hl_variable" href="../../d5/dc0/namespace_kratos_1_1_globals.html#ae57da311aaf349aa883363f673e534fc">Globals::Pi</a> / angular_period;</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>                <span class="keywordtype">double</span> inv_angular_omega = 1.0 / angular_omega;</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>                <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(angle) = angular_velocity * std::sin(angular_omega * (angular_velocity_stop_time - angular_velocity_start_time)) * inv_angular_omega;</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>                <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(angle) = angular_velocity * (angular_velocity_stop_time - angular_velocity_start_time);</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>            }</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>        }</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span> </div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>        <span class="comment">//mod_angular_velocity = MathUtils&lt;double&gt;::Norm3(angular_velocity);</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span> </div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>        new_axes1[0] = 1.0;</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>        new_axes1[1] = 0.0;</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>        new_axes1[2] = 0.0;</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span> </div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>        new_axes2[0] = 0.0;</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>        new_axes2[1] = 1.0;</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>        new_axes2[2] = 0.0;</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span> </div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>        new_axes3[0] = 0.0;</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>        new_axes3[1] = 0.0;</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>        new_axes3[2] = 1.0;</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span> </div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>        <span class="keywordflow">if</span> (mod_angular_velocity &gt; 0.0) {</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span> </div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>            <span class="keywordtype">double</span> ang = sign_angle * <a class="code hl_function" href="../../d2/df1/class_kratos_1_1_math_utils.html#a7b2eab287f67cf69dcc536fe4f533db5">MathUtils&lt;double&gt;::Norm3</a>(angle);</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>            <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> rotation_axis;</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>            <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(rotation_axis) = angular_velocity / mod_angular_velocity;</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>            <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> e1;</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>            e1[0] = 1.0;</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>            e1[1] = 0.0;</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>            e1[2] = 0.0;</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span> </div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>            <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> e2;</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>            e2[0] = 0.0;</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>            e2[1] = 1.0;</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>            e2[2] = 0.0;</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span> </div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>            <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a2658e0a68e9d374ec08c496099bda9f9">RotateRightHandedBasisAroundAxis</a>(e1, e2, rotation_axis, ang, new_axes1, new_axes2, new_axes3);</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>        }</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>    }</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span> </div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aa5b886ee8ed2deebad2c51bb086023bd">  448</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aa5b886ee8ed2deebad2c51bb086023bd">UpdateKinematicVariablesOfAGridOfNodes</a>(<span class="keywordtype">double</span> mod_angular_velocity, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; linear_velocity,</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>                                                              <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; initial_center, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; new_axes1, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; new_axes2,</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>                                                              <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; new_axes3, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; angular_velocity_changed,</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>                                                              <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; linear_velocity_changed, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; center_position,</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>                                                              <span class="keyword">const</span> <span class="keywordtype">bool</span> fixed_mesh, <span class="keyword">const</span> <span class="keywordtype">double</span> dt, ModelPart::NodesContainerType&amp; pNodes)</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>    {</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>        <span class="keywordflow">if</span> (mod_angular_velocity &gt; std::numeric_limits&lt;double&gt;::epsilon() || <a class="code hl_class" href="../../d2/df1/class_kratos_1_1_math_utils.html">MathUtils&lt;double&gt;::Norm3</a>(linear_velocity) &gt; std::numeric_limits&lt;double&gt;::epsilon()) {</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span> </div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span><span class="preprocessor">            #pragma omp parallel for</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; (int)pNodes.size(); k++) {</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span> </div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>                <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> local_coordinates = <a class="code hl_typedef" href="../../db/d66/namespace_kratos.html#a0060702fbd6c7d45c773436101c9ded3">ZeroVector</a>(3);</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>                <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> relative_position = <a class="code hl_typedef" href="../../db/d66/namespace_kratos.html#a0060702fbd6c7d45c773436101c9ded3">ZeroVector</a>(3);</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span> </div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>                ModelPart::NodeIterator <a class="code hl_struct" href="../../d5/da1/structnode.html">node</a> = pNodes.begin() + k;</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span> </div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>                <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(local_coordinates) = <a class="code hl_struct" href="../../d5/da1/structnode.html">node</a>-&gt;GetInitialPosition().Coordinates() - initial_center;</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>                <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(relative_position) = new_axes1 * local_coordinates[0] + new_axes2 * local_coordinates[1] + new_axes3 * local_coordinates[2];</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>                <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> old_coordinates;</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>                <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(old_coordinates) = <a class="code hl_struct" href="../../d5/da1/structnode.html">node</a>-&gt;Coordinates();</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>                <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> velocity_due_to_rotation;</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>                <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; velocity = <a class="code hl_struct" href="../../d5/da1/structnode.html">node</a>-&gt;FastGetSolutionStepValue(VELOCITY);</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span> </div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>                <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">CrossProduct</a>(angular_velocity_changed, relative_position, velocity_due_to_rotation);</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>                <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(velocity) = linear_velocity_changed + velocity_due_to_rotation;</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span> </div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>                <span class="keywordflow">if</span> (!fixed_mesh) {</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>                    <span class="comment">// NEW POSITION</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>                    <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(<a class="code hl_struct" href="../../d5/da1/structnode.html">node</a>-&gt;Coordinates()) = center_position + relative_position;</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>                    <span class="comment">// DISPLACEMENT</span></div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>                    <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(<a class="code hl_struct" href="../../d5/da1/structnode.html">node</a>-&gt;FastGetSolutionStepValue(DISPLACEMENT)) = <a class="code hl_struct" href="../../d5/da1/structnode.html">node</a>-&gt;Coordinates() - <a class="code hl_struct" href="../../d5/da1/structnode.html">node</a>-&gt;GetInitialPosition().Coordinates();</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>                    <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(<a class="code hl_struct" href="../../d5/da1/structnode.html">node</a>-&gt;FastGetSolutionStepValue(DELTA_DISPLACEMENT)) = <a class="code hl_struct" href="../../d5/da1/structnode.html">node</a>-&gt;Coordinates() - old_coordinates;</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>                    (<a class="code hl_struct" href="../../d5/da1/structnode.html">node</a>-&gt;FastGetSolutionStepValue(DISPLACEMENT)).clear(); <span class="comment">//Set values to zero</span></div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>                    <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(<a class="code hl_struct" href="../../d5/da1/structnode.html">node</a>-&gt;FastGetSolutionStepValue(DELTA_DISPLACEMENT)) = velocity * dt; <span class="comment">//But still there must be some delta_displacement (or motion won&#39;t be detected by the spheres!)</span></div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>                }</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>            }</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>        }</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>    }</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span> </div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>    <span class="comment">//NOTE:: Modified by M. Santasusana Feb 2013 - simplification (the one proposed by F. Chun was for a more generalized case)</span></div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span> </div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a39f63df8ff12dd40eb983fc7562d7015">  490</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a39f63df8ff12dd40eb983fc7562d7015">ComputeContactLocalCoordSystem</a>(<a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> NormalDirection, <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; distance, <span class="keywordtype">double</span> LocalCoordSystem[3][3])  <span class="comment">//inline: modifies the LocalCoordSystem as it were a reference</span></div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>    {</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>        <span class="keywordtype">double</span> inv_distance = (distance != 0.0) ? 1.0 / distance : 0.0;</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>        NormalDirection[0] *= inv_distance;</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>        NormalDirection[1] *= inv_distance;</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>        NormalDirection[2] *= inv_distance;</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>        <span class="keywordtype">double</span> N_fast[3];</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>        N_fast[0] = NormalDirection[0];</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>        N_fast[1] = NormalDirection[1];</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>        N_fast[2] = NormalDirection[2];</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span> </div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>        <span class="keywordflow">if</span> (fabs(N_fast[0]) &gt;= 0.577) <span class="comment">//0.57735026919</span></div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>        {</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>            LocalCoordSystem[0][0] = - N_fast[1];</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>            LocalCoordSystem[0][1] = N_fast[0];</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>            LocalCoordSystem[0][2] = 0.0;</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>        }</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fabs(N_fast[1]) &gt;= 0.577)</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>        {</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>            LocalCoordSystem[0][0] = 0.0;</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>            LocalCoordSystem[0][1] = - N_fast[2];</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>            LocalCoordSystem[0][2] = N_fast[1];</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>        }</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>        {</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>            LocalCoordSystem[0][0] = N_fast[2];</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>            LocalCoordSystem[0][1] = 0.0;</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>            LocalCoordSystem[0][2] = - N_fast[0];</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>        }</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span> </div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>        <span class="comment">//normalize(Vector0);</span></div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>        <span class="keywordtype">double</span> distance0 = <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a33d81a3e79bb06d94c0d6b7ceb3b4c05">DEM_MODULUS_3</a>(LocalCoordSystem[0]);</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>        <span class="keywordtype">double</span> inv_distance0 = (distance0 != 0.0) ? 1.0 / distance0 : 0.0;</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>        LocalCoordSystem[0][0] = LocalCoordSystem[0][0] * inv_distance0;</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>        LocalCoordSystem[0][1] = LocalCoordSystem[0][1] * inv_distance0;</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>        LocalCoordSystem[0][2] = LocalCoordSystem[0][2] * inv_distance0;</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span> </div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>        <span class="comment">//CrossProduct(NormalDirection, Vector0, Vector1);</span></div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>        LocalCoordSystem[1][0] = N_fast[1] * LocalCoordSystem[0][2] - N_fast[2] * LocalCoordSystem[0][1];</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>        LocalCoordSystem[1][1] = N_fast[2] * LocalCoordSystem[0][0] - N_fast[0] * LocalCoordSystem[0][2];</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>        LocalCoordSystem[1][2] = N_fast[0] * LocalCoordSystem[0][1] - N_fast[1] * LocalCoordSystem[0][0];</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span> </div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>        <span class="comment">//normalize(Vector1);</span></div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span> </div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>        LocalCoordSystem[2][0] = N_fast[0];</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>        LocalCoordSystem[2][1] = N_fast[1];</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>        LocalCoordSystem[2][2] = N_fast[2];</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>    }</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span> </div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aad87cabb87e339cb0dcef29fd6064907">  539</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aad87cabb87e339cb0dcef29fd6064907">DistanceOfTwoPoint</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> coord1[3], <span class="keyword">const</span> <span class="keywordtype">double</span> coord2[3])</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>    {</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>        <span class="keywordtype">double</span> dx = coord1[0] - coord2[0];</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>        <span class="keywordtype">double</span> dy = coord1[1] - coord2[1];</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>        <span class="keywordtype">double</span> dz = coord1[2] - coord2[2];</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span> </div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>        <span class="keywordflow">return</span> sqrt(dx * dx + dy * dy + dz * dz);</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>    }</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span> </div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a3bfb72e5c6961f314eb3b9c2dc8e558b">  548</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aad87cabb87e339cb0dcef29fd6064907">DistanceOfTwoPoint</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; coord1, <span class="keyword">const</span> <span class="keywordtype">double</span> coord2[3])</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>    {</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>        <span class="keywordtype">double</span> dx = coord1[0] - coord2[0];</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>        <span class="keywordtype">double</span> dy = coord1[1] - coord2[1];</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>        <span class="keywordtype">double</span> dz = coord1[2] - coord2[2];</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span> </div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>        <span class="keywordflow">return</span> sqrt(dx * dx + dy * dy + dz * dz);</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>    }</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span> </div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aa5b3afa9f1931218e026b55f1cb58ec6">  557</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aa5b3afa9f1931218e026b55f1cb58ec6">DistanceOfTwoPointSquared</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; coord1, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; coord2)</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>    {</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>        <span class="keywordtype">double</span> dx = coord1[0] - coord2[0];</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>        <span class="keywordtype">double</span> dy = coord1[1] - coord2[1];</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>        <span class="keywordtype">double</span> dz = coord1[2] - coord2[2];</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span> </div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>        <span class="keywordflow">return</span> (dx * dx + dy * dy + dz * dz);</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>    }</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span> </div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#abc3c0d3d9c40c34667260b7e5ed529da">  566</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aa5b3afa9f1931218e026b55f1cb58ec6">DistanceOfTwoPointSquared</a>(<span class="keywordtype">double</span> coord1[3], <span class="keywordtype">double</span> coord2[3])</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>    {</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>        <span class="keywordtype">double</span> dx = coord1[0] - coord2[0];</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>        <span class="keywordtype">double</span> dy = coord1[1] - coord2[1];</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>        <span class="keywordtype">double</span> dz = coord1[2] - coord2[2];</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span> </div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>        <span class="keywordflow">return</span> (dx * dx + dy * dy + dz * dz);</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>    }</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab6a0ffd732c17095cec3cc6826bfcbe7">  574</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab6a0ffd732c17095cec3cc6826bfcbe7">DistancePointToPlane</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; CoordInPlane, <span class="keywordtype">double</span> PlaneUnitNormalVector[3], <span class="keywordtype">double</span> TestCoord[3])</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>    {</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>        <span class="keywordtype">double</span> Vector1[3] = {0.0};</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span> </div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i&lt;3; i++)</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>        {</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>            Vector1[i] = TestCoord[i]- CoordInPlane[i];</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>        }</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span> </div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>        <span class="keywordtype">double</span> dist = fabs (<a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae3bbd7194a2ffdee9412e5b3ad716e26">DotProduct</a>(Vector1, PlaneUnitNormalVector));</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span> </div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>        <span class="keywordflow">return</span> dist;</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>    }</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span> </div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a84c07e46836a58fe4e940cf567ca597a">  588</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a84c07e46836a58fe4e940cf567ca597a">CoordProjectionOnPlane</a>(<span class="keywordtype">double</span> CoordOut[3], <span class="keywordtype">double</span> CoordIn[3], <span class="keywordtype">double</span> LocalCoordSystem[3][3], <span class="keywordtype">double</span> IntersectionCoord[3])</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>    {</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>        <span class="keywordtype">double</span> out_coord_local[3] = {0.0};</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>        <span class="keywordtype">double</span> in_coord_local[3]  = {0.0};</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span> </div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afcfb83ddbb3c0ece824748b9b2e1c7fa">VectorGlobal2Local</a>(LocalCoordSystem, CoordOut, out_coord_local);</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afcfb83ddbb3c0ece824748b9b2e1c7fa">VectorGlobal2Local</a>(LocalCoordSystem, CoordIn,  in_coord_local);</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span> </div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>        <span class="keywordtype">double</span> vector1[3] = {0.0};</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>        vector1[0] = out_coord_local[0];</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>        vector1[1] = out_coord_local[1];</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>        vector1[2] = in_coord_local [2];</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span> </div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a1e040cca465a7040da307e031155e3c3">VectorLocal2Global</a>(LocalCoordSystem, vector1, IntersectionCoord);</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span> </div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>    }</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span> </div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae93507f29577a1b3937dbd77936731ac">  605</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae93507f29577a1b3937dbd77936731ac">CoordProjectionOnPlaneNew</a>(<span class="keywordtype">double</span> CoordOut[3], <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; CoordIn, <span class="keywordtype">double</span> LocalCoordSystem[3][3], <span class="keywordtype">double</span> IntersectionCoord[3])</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>    {</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>        <span class="keywordtype">double</span> out_coord_local[3] = {0.0};</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>        <span class="keywordtype">double</span> in_coord_local[3]  = {0.0};</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span> </div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afcfb83ddbb3c0ece824748b9b2e1c7fa">VectorGlobal2Local</a>(LocalCoordSystem, CoordOut, out_coord_local);</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afcfb83ddbb3c0ece824748b9b2e1c7fa">VectorGlobal2Local</a>(LocalCoordSystem, CoordIn,  in_coord_local);</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span> </div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>        <span class="keywordtype">double</span> vector1[3] = {0.0};</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>        vector1[0] = out_coord_local[0];</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>        vector1[1] = out_coord_local[1];</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>        vector1[2] = in_coord_local [2];</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span> </div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a1e040cca465a7040da307e031155e3c3">VectorLocal2Global</a>(LocalCoordSystem, vector1, IntersectionCoord);</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span> </div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>    }</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span> </div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a3dbb20067718c4e219ee51f0024739f2">  622</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a3dbb20067718c4e219ee51f0024739f2">Compute3DimElementFaceLocalSystem</a>(<span class="keyword">const</span> array_1d &lt;double,3&gt;&amp; FaceCoord1, <span class="keyword">const</span> array_1d &lt;double,3&gt;&amp; FaceCoord2, <span class="keyword">const</span> array_1d &lt;double,3&gt;&amp; FaceCoord3, <span class="keywordtype">double</span> ParticleCoord[3],</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>                                                          <span class="keywordtype">double</span> LocalCoordSystem[3][3], <span class="keywordtype">double</span>&amp; normal_flag)</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>    {</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>        <span class="comment">//NOTE: this function is designed in a way that the normal always points the side where the center of particle is found. Therefore should only be used in this way if the indentation is less than the radius value.</span></div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>        <span class="comment">//the function returns a flag with the same value as the dot product of the normal of the triangle and the normal pointing to the particle.</span></div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span> </div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>        <span class="keywordtype">double</span> Vector1[3] = {0.0};</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>        <span class="keywordtype">double</span> Vector2[3] = {0.0};</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>        <span class="keywordtype">double</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">Vector3</a>[3] = {0.0};</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>        <span class="keywordtype">double</span> Normal[3]  = {0.0};</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span> </div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>        Vector1[0] = FaceCoord2[0] - FaceCoord1[0];</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>        Vector1[1] = FaceCoord2[1] - FaceCoord1[1];</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>        Vector1[2] = FaceCoord2[2] - FaceCoord1[2];</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span> </div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>        Vector2[0] = FaceCoord3[0] - FaceCoord2[0];</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>        Vector2[1] = FaceCoord3[1] - FaceCoord2[1];</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>        Vector2[2] = FaceCoord3[2] - FaceCoord2[2];</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span> </div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>(Vector1);</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">CrossProduct</a>(Vector1, Vector2, Normal);</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>(Normal);</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span> </div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">CrossProduct</a>(Normal, Vector1, Vector2);</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>(Vector2);</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span> </div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">Vector3</a>[0] = ParticleCoord[0] - FaceCoord1[0];</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">Vector3</a>[1] = ParticleCoord[1] - FaceCoord1[1];</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">Vector3</a>[2] = ParticleCoord[2] - FaceCoord1[2];</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span> </div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>(<a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">Vector3</a>);</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span> </div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae3bbd7194a2ffdee9412e5b3ad716e26">DotProduct</a>(<a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">Vector3</a>, Normal) &gt; 0.0)</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>        {</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ia = 0; ia &lt; 3; ia++)</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>            {</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>                normal_flag             = 1.0;</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>                LocalCoordSystem[0][ia] = Vector1[ia];</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>                LocalCoordSystem[1][ia] = Vector2[ia];</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>                LocalCoordSystem[2][ia] = Normal [ia];</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>           }</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>        }</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>        {</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ia = 0; ia &lt; 3; ia++)</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>            {</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>                normal_flag             = -1.0;</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>                LocalCoordSystem[0][ia] = -Vector1[ia];</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>                LocalCoordSystem[1][ia] = -Vector2[ia];</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>                LocalCoordSystem[2][ia] = -Normal [ia];</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>            }</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>        }</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>    }</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span> </div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>    <span class="comment">//MSIMSI this one is being used only for distributed... adapt it</span></div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a006f26177b30f85776e444e5d9fc7767">  677</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a3dbb20067718c4e219ee51f0024739f2">Compute3DimElementFaceLocalSystem</a>(<span class="keywordtype">double</span> FaceCoord1[3], <span class="keywordtype">double</span> FaceCoord2[3], <span class="keywordtype">double</span> FaceCoord3[3], <span class="keywordtype">double</span> ParticleCoord[3],</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>                                                         <span class="keywordtype">double</span> LocalCoordSystem[3][3], <span class="keywordtype">double</span>&amp; normal_flag){</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span> </div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>        <span class="comment">//NOTE: this function is designed in a way that the normal always points the side where the center of particle is found. Therefore should only be used in this way if the indentation is less than the radius value.</span></div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>        <span class="comment">//the function returns a flag with the same value as the dot product of the normal of the triangle and the normal pointing to the particle.</span></div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span> </div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>        <span class="keywordtype">double</span> Vector1[3] = {0.0};</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>        <span class="keywordtype">double</span> Vector2[3] = {0.0};</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>        <span class="keywordtype">double</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">Vector3</a>[3] = {0.0};</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>        <span class="keywordtype">double</span> Normal[3]  = {0.0};</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span> </div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>        Vector1[0] = FaceCoord2[0] - FaceCoord1[0];</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>        Vector1[1] = FaceCoord2[1] - FaceCoord1[1];</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>        Vector1[2] = FaceCoord2[2] - FaceCoord1[2];</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span> </div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>        Vector2[0] = FaceCoord3[0] - FaceCoord2[0];</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>        Vector2[1] = FaceCoord3[1] - FaceCoord2[1];</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>        Vector2[2] = FaceCoord3[2] - FaceCoord2[2];</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span> </div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>(Vector1);</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">CrossProduct</a>(Vector1, Vector2, Normal);</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>(Normal);</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span> </div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">CrossProduct</a>(Normal, Vector1, Vector2);</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>(Vector2);</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span> </div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">Vector3</a>[0] = ParticleCoord[0] - FaceCoord1[0];</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">Vector3</a>[1] = ParticleCoord[1] - FaceCoord1[1];</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">Vector3</a>[2] = ParticleCoord[2] - FaceCoord1[2];</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>(<a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">Vector3</a>);</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span> </div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae3bbd7194a2ffdee9412e5b3ad716e26">DotProduct</a>(<a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">Vector3</a>, Normal) &gt; 0.0)</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>        {</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ia = 0; ia &lt; 3; ia++)</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>            {</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>                normal_flag             = 1.0;</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>                LocalCoordSystem[0][ia] = Vector1[ia];</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>                LocalCoordSystem[1][ia] = Vector2[ia];</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>                LocalCoordSystem[2][ia] = Normal [ia];</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>            }</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>        }</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>        {</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ia = 0; ia &lt; 3; ia++)</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>            {</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>                normal_flag             = -1.0;</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>                LocalCoordSystem[0][ia] = -Vector1[ia];</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>                LocalCoordSystem[1][ia] = -Vector2[ia];</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>                LocalCoordSystem[2][ia] = -Normal [ia];</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>            }</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>        }</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>    }<span class="comment">//Compute3DimElementFaceLocalSystem</span></div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span> </div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span> </div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span> </div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a92cd4c64cb64ef8781a9adfa78f09ae9">  735</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a92cd4c64cb64ef8781a9adfa78f09ae9">RotatePointAboutArbitraryLine</a>(<a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; TargetPoint, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; CentrePoint, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; LineVector, <span class="keyword">const</span> <span class="keywordtype">double</span> RotationAngle)</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>    {</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>        <span class="keyword">const</span> <span class="keywordtype">double</span> O = RotationAngle;</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>        <span class="keywordtype">double</span> x = TargetPoint[0], a = CentrePoint[0], u = LineVector[0];</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>        <span class="keywordtype">double</span> y = TargetPoint[1], b = CentrePoint[1], v = LineVector[1];</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>        <span class="keywordtype">double</span> z = TargetPoint[2], c = CentrePoint[2], w = LineVector[2];</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>        <span class="keywordtype">double</span> L = u*u+v*v+w*w;</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span> </div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>        <span class="keywordflow">if</span> (L==0)</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>        {</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>        }</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>        {</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> inv_L = 1.0 / L;</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>        TargetPoint[0] = ((a*(v*v+w*w)-u*(b*v+c*w-u*x-v*y-w*z))*(1-cos(O))+L*x*cos(O)+sqrt(L)*(-c*w+b*w-w*y+v*z)*sin(O))* inv_L;</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>        TargetPoint[1] = ((b*(u*u+w*w)-v*(a*u+c*w-u*x-v*y-w*z))*(1-cos(O))+L*y*cos(O)+sqrt(L)*(c*u-a*w+w*x-u*z)*sin(O))* inv_L;</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>        TargetPoint[2] = ((c*(u*u+v*v)-w*(a*u+b*v-u*x-v*y-w*z))*(1-cos(O))+L*z*cos(O)+sqrt(L)*(-b*u+a*v-v*x+u*y)*sin(O))* inv_L;</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>        }</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>    }</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span> </div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span> </div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a2966caf76d2080f6bf0b3aca3e9a40c3">  759</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a2966caf76d2080f6bf0b3aca3e9a40c3">QuaternionVectorLocal2Global</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a>&amp; Q, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; LocalVector, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; GlobalVector)</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>    {</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>        Q.RotateVector3(LocalVector, GlobalVector);</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>    }</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span> </div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a1645d874bbf5348c6e1352178aff0b43">  764</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a1645d874bbf5348c6e1352178aff0b43">QuaternionVectorGlobal2Local</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a>&amp; Q, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; GlobalVector, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; LocalVector)</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>    {</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>        <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a> Q_conj = Q.conjugate();</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>        Q_conj.<a class="code hl_function" href="../../da/de5/class_kratos_1_1_quaternion.html#a63912bf4600aff6a709d7460699a7b3c">RotateVector3</a>(GlobalVector, LocalVector);</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>    }</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span> </div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab4b8cf8d84059172cdaceb96a51b0f90">  770</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab4b8cf8d84059172cdaceb96a51b0f90">QuaternionTensorLocal2Global</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a>&amp; Q, <span class="keyword">const</span> <span class="keywordtype">double</span> LocalTensor[3][3], <span class="keywordtype">double</span> GlobalTensor[3][3])</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>    {</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> LocalTensorC1; <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> LocalTensorC2; <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> LocalTensorC3;</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span> </div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>        LocalTensorC1[0] = LocalTensor[0][0]; LocalTensorC2[0] = LocalTensor[0][1]; LocalTensorC3[0] = LocalTensor[0][2];</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>        LocalTensorC1[1] = LocalTensor[1][0]; LocalTensorC2[1] = LocalTensor[1][1]; LocalTensorC3[1] = LocalTensor[1][2];</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>        LocalTensorC1[2] = LocalTensor[2][0]; LocalTensorC2[2] = LocalTensor[2][1]; LocalTensorC3[2] = LocalTensor[2][2];</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span> </div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> TempTensorC1; <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> TempTensorC2; <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> TempTensorC3;</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> TempTensorTraspC1; <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> TempTensorTraspC2; <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> TempTensorTraspC3;</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span> </div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>        Q.RotateVector3(LocalTensorC1, TempTensorC1);</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>        Q.RotateVector3(LocalTensorC2, TempTensorC2);</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>        Q.RotateVector3(LocalTensorC3, TempTensorC3);</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span> </div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>        TempTensorTraspC1[0] = TempTensorC1[0]; TempTensorTraspC2[0] = TempTensorC1[1]; TempTensorTraspC3[0] = TempTensorC1[2];</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>        TempTensorTraspC1[1] = TempTensorC2[0]; TempTensorTraspC2[1] = TempTensorC2[1]; TempTensorTraspC3[1] = TempTensorC2[2];</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>        TempTensorTraspC1[2] = TempTensorC3[0]; TempTensorTraspC2[2] = TempTensorC3[1]; TempTensorTraspC3[2] = TempTensorC3[2];</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span> </div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> GlobalTensorTraspC1; <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> GlobalTensorTraspC2; <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> GlobalTensorTraspC3;</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span> </div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>        Q.RotateVector3(TempTensorTraspC1, GlobalTensorTraspC1);</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>        Q.RotateVector3(TempTensorTraspC2, GlobalTensorTraspC2);</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>        Q.RotateVector3(TempTensorTraspC3, GlobalTensorTraspC3);</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span> </div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>        GlobalTensor[0][0] = GlobalTensorTraspC1[0]; GlobalTensor[0][1] = GlobalTensorTraspC1[1]; GlobalTensor[0][2] = GlobalTensorTraspC1[2];</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>        GlobalTensor[1][0] = GlobalTensorTraspC2[0]; GlobalTensor[1][1] = GlobalTensorTraspC2[1]; GlobalTensor[1][2] = GlobalTensorTraspC2[2];</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>        GlobalTensor[2][0] = GlobalTensorTraspC3[0]; GlobalTensor[2][1] = GlobalTensorTraspC3[1]; GlobalTensor[2][2] = GlobalTensorTraspC3[2];</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>    }</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span> </div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aeff6a1ccab096f8951610964c6b0727e">  800</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aeff6a1ccab096f8951610964c6b0727e">UpdateOrientation</a>(<a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; EulerAngles, <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a>&amp; Orientation, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; DeltaRotation)</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>    {</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>        <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a> DeltaOrientation = <a class="code hl_function" href="../../da/de5/class_kratos_1_1_quaternion.html#a05c4d8f18e012cb9f7a3eaed6808317e">Quaternion&lt;double&gt;::Identity</a>();</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span> </div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3 &gt;</a> theta = DeltaRotation;</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>        <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a5961243e3c6063179b397f430f5bad24">DEM_MULTIPLY_BY_SCALAR_3</a>(theta, 0.5);</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span> </div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>        <span class="keywordtype">double</span> thetaMag = <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a33d81a3e79bb06d94c0d6b7ceb3b4c05">DEM_MODULUS_3</a>(theta);</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>        <span class="keyword">const</span> <span class="keywordtype">double</span> epsilon = std::numeric_limits&lt;double&gt;::epsilon();</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span> </div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>        <span class="keywordflow">if</span> (thetaMag * thetaMag * thetaMag * thetaMag / 24.0 &lt; epsilon) { <span class="comment">//Taylor: low angle</span></div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>            <span class="keywordtype">double</span> aux = (1 - thetaMag * thetaMag / 6);</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>            DeltaOrientation = <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a>((1 + thetaMag * thetaMag / 2), theta[0]*aux, theta[1]*aux, theta[2]*aux);</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>            DeltaOrientation.<a class="code hl_function" href="../../da/de5/class_kratos_1_1_quaternion.html#a1d560a6c082202c9347c7ab8697001be">normalize</a>();</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>        }</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>        <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>            <span class="keywordtype">double</span> aux = std::sin(thetaMag)/thetaMag;</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>            DeltaOrientation = <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a>(cos(thetaMag), theta[0]*aux, theta[1]*aux, theta[2]*aux);</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>            DeltaOrientation.<a class="code hl_function" href="../../da/de5/class_kratos_1_1_quaternion.html#a1d560a6c082202c9347c7ab8697001be">normalize</a>();</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>        }</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>        Orientation = DeltaOrientation * Orientation;</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>        Orientation.<a class="code hl_function" href="../../da/de5/class_kratos_1_1_quaternion.html#a56c77438bf6d1a26a189420d100ac16d">ToEulerAngles</a>(EulerAngles);</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>    }</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span> </div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a895a164f53c69109f034584a3acaa8be">  824</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aeff6a1ccab096f8951610964c6b0727e">UpdateOrientation</a>(<a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a>&amp; Orientation, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; DeltaRotation)</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>    {</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>        <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a> DeltaOrientation = <a class="code hl_function" href="../../da/de5/class_kratos_1_1_quaternion.html#a05c4d8f18e012cb9f7a3eaed6808317e">Quaternion&lt;double&gt;::Identity</a>();</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span> </div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3 &gt;</a> theta = DeltaRotation;</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>        <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a5961243e3c6063179b397f430f5bad24">DEM_MULTIPLY_BY_SCALAR_3</a>(theta, 0.5);</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span> </div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>        <span class="keywordtype">double</span> thetaMag = <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a33d81a3e79bb06d94c0d6b7ceb3b4c05">DEM_MODULUS_3</a>(theta);</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>        <span class="keyword">const</span> <span class="keywordtype">double</span> epsilon = std::numeric_limits&lt;double&gt;::epsilon();</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span> </div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>        <span class="keywordflow">if</span> (thetaMag * thetaMag * thetaMag * thetaMag / 24.0 &lt; epsilon) { <span class="comment">//Taylor: low angle</span></div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>            <span class="keywordtype">double</span> aux = (1 - thetaMag * thetaMag / 6);</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>            DeltaOrientation = <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a>((1 + thetaMag * thetaMag * 0.5), theta[0]*aux, theta[1]*aux, theta[2]*aux);</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>            DeltaOrientation.<a class="code hl_function" href="../../da/de5/class_kratos_1_1_quaternion.html#a1d560a6c082202c9347c7ab8697001be">normalize</a>();</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>        }</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>        <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>            <span class="keywordtype">double</span> aux = std::sin(thetaMag)/thetaMag;</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>            DeltaOrientation = <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a>(cos(thetaMag), theta[0]*aux, theta[1]*aux, theta[2]*aux);</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>            DeltaOrientation.<a class="code hl_function" href="../../da/de5/class_kratos_1_1_quaternion.html#a1d560a6c082202c9347c7ab8697001be">normalize</a>();</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>        }</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>        Orientation = DeltaOrientation * Orientation;</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>    }</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span> </div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#adf8845b266daedd78a1d04cb04c949eb">  847</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aeff6a1ccab096f8951610964c6b0727e">UpdateOrientation</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a>&amp; Orientation, <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a>&amp; NewOrientation, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; DeltaRotation)</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>    {</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>        <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a> DeltaOrientation = <a class="code hl_function" href="../../da/de5/class_kratos_1_1_quaternion.html#a05c4d8f18e012cb9f7a3eaed6808317e">Quaternion&lt;double&gt;::Identity</a>();</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span> </div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3 &gt;</a> theta = DeltaRotation;</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>        <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a5961243e3c6063179b397f430f5bad24">DEM_MULTIPLY_BY_SCALAR_3</a>(theta, 0.5);</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span> </div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>        <span class="keywordtype">double</span> thetaMag = <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a33d81a3e79bb06d94c0d6b7ceb3b4c05">DEM_MODULUS_3</a>(theta);</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>        <span class="keyword">const</span> <span class="keywordtype">double</span> epsilon = std::numeric_limits&lt;double&gt;::epsilon();</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span> </div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>        <span class="keywordflow">if</span> (thetaMag * thetaMag * thetaMag * thetaMag / 24.0 &lt; epsilon) { <span class="comment">//Taylor: low angle</span></div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>            <span class="keywordtype">double</span> aux = (1 - thetaMag * thetaMag / 6);</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>            DeltaOrientation = <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a>((1 + thetaMag * thetaMag * 0.5), theta[0]*aux, theta[1]*aux, theta[2]*aux);</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>            DeltaOrientation.<a class="code hl_function" href="../../da/de5/class_kratos_1_1_quaternion.html#a1d560a6c082202c9347c7ab8697001be">normalize</a>();</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>        }</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>        <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>            <span class="keywordtype">double</span> aux = std::sin(thetaMag)/thetaMag;</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>            DeltaOrientation = <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a>(cos(thetaMag), theta[0]*aux, theta[1]*aux, theta[2]*aux);</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>            DeltaOrientation.<a class="code hl_function" href="../../da/de5/class_kratos_1_1_quaternion.html#a1d560a6c082202c9347c7ab8697001be">normalize</a>();</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>        }</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>        NewOrientation = DeltaOrientation * Orientation;</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>    }</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span> </div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a4e986e29b94d7b5516a8031cf6efdaa8">  870</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a4e986e29b94d7b5516a8031cf6efdaa8">EulerAnglesFromRotationAngle</a>(<a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; EulerAngles, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; RotatedAngle)</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>    {</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>        <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a> Orientation = <a class="code hl_function" href="../../da/de5/class_kratos_1_1_quaternion.html#a05c4d8f18e012cb9f7a3eaed6808317e">Quaternion&lt;double&gt;::Identity</a>();</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span> </div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3 &gt;</a> theta = RotatedAngle;</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>        <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a5961243e3c6063179b397f430f5bad24">DEM_MULTIPLY_BY_SCALAR_3</a>(theta, 0.5);</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span> </div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>        <span class="keywordtype">double</span> thetaMag = <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a33d81a3e79bb06d94c0d6b7ceb3b4c05">DEM_MODULUS_3</a>(theta);</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span> </div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>        <span class="keyword">const</span> <span class="keywordtype">double</span> epsilon = std::numeric_limits&lt;double&gt;::epsilon();</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span> </div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>        <span class="keywordflow">if</span> (thetaMag * thetaMag * thetaMag * thetaMag / 24.0 &lt; epsilon) { <span class="comment">//Taylor: low angle</span></div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>            <span class="keywordtype">double</span> aux = (1 - thetaMag * thetaMag / 6);</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>            Orientation = <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a>((1 + thetaMag * thetaMag / 2), theta[0]*aux, theta[1]*aux, theta[2]*aux);</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>            Orientation.<a class="code hl_function" href="../../da/de5/class_kratos_1_1_quaternion.html#a1d560a6c082202c9347c7ab8697001be">normalize</a>();</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>        }</div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>        <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>            <span class="keywordtype">double</span> aux = std::sin(thetaMag)/thetaMag;</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>            Orientation = <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a>(cos(thetaMag), theta[0]*aux, theta[1]*aux, theta[2]*aux);</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>            Orientation.<a class="code hl_function" href="../../da/de5/class_kratos_1_1_quaternion.html#a1d560a6c082202c9347c7ab8697001be">normalize</a>();</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>        }</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>        Orientation.<a class="code hl_function" href="../../da/de5/class_kratos_1_1_quaternion.html#a56c77438bf6d1a26a189420d100ac16d">ToEulerAngles</a>(EulerAngles);</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>    }</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span> </div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a8b82ff18a2325582290edbf260630125">  894</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a8b82ff18a2325582290edbf260630125">OrientationFromRotationAngle</a>(<a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a>&amp; DeltaOrientation, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; DeltaRotation)</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>    {</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3 &gt;</a> theta = DeltaRotation;</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>        <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a5961243e3c6063179b397f430f5bad24">DEM_MULTIPLY_BY_SCALAR_3</a>(theta, 0.5);</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span> </div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>        <span class="keywordtype">double</span> thetaMag = <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a33d81a3e79bb06d94c0d6b7ceb3b4c05">DEM_MODULUS_3</a>(theta);</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>        <span class="keyword">const</span> <span class="keywordtype">double</span> epsilon = std::numeric_limits&lt;double&gt;::epsilon();</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span> </div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>        <span class="keywordflow">if</span> (thetaMag * thetaMag * thetaMag * thetaMag / 24.0 &lt; epsilon) { <span class="comment">//Taylor: low angle</span></div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>            <span class="keywordtype">double</span> aux = (1 - thetaMag * thetaMag / 6);</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>            DeltaOrientation = <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a>((1 + thetaMag * thetaMag / 2), theta[0]*aux, theta[1]*aux, theta[2]*aux);</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>            DeltaOrientation.<a class="code hl_function" href="../../da/de5/class_kratos_1_1_quaternion.html#a1d560a6c082202c9347c7ab8697001be">normalize</a>();</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>        }</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>        <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>            <span class="keywordtype">double</span> aux = std::sin(thetaMag)/thetaMag;</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>            DeltaOrientation = <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a>(cos(thetaMag), theta[0]*aux, theta[1]*aux, theta[2]*aux);</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>            DeltaOrientation.<a class="code hl_function" href="../../da/de5/class_kratos_1_1_quaternion.html#a1d560a6c082202c9347c7ab8697001be">normalize</a>();</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>        }</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>    }</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span> </div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span> </div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span> </div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>    <span class="comment">/*static inline void CalculateEulerAngles(const array_1d&lt;double,3&gt;&amp; OriginalVector_X, const array_1d&lt;double,3&gt;&amp; OriginalVector_Z,</span></div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span><span class="comment">                const array_1d&lt;double,3&gt;&amp; RotatedVector_X, const array_1d&lt;double,3&gt;&amp; RotatedVector_Z, array_1d&lt;double,3&gt;&amp; EulerAngles)</span></div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span><span class="comment">    {</span></div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span><span class="comment"></span> </div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span><span class="comment">        array_1d&lt; double,3 &gt; N = ZeroVector(3);</span></div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span><span class="comment"></span> </div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span><span class="comment"></span> </div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span><span class="comment"></span> </div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span><span class="comment">        CrossProduct( OriginalVector_Z, RotatedVector_Z, N);</span></div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span><span class="comment"></span> </div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span><span class="comment">        double return1 = DotProduct(N,OriginalVector_X);   //cos(Alpha)</span></div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span><span class="comment">        double return2 = DotProduct(OriginalVector_Z, RotatedVector_Z); //cos(Beta)</span></div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span><span class="comment">        double return3 = DotProduct(N,RotatedVector_X); //cos(Gamma)</span></div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span><span class="comment"></span> </div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span><span class="comment">        EulerAngles[0] = acos(return1);</span></div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span><span class="comment">        EulerAngles[1] = acos(return2);</span></div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span><span class="comment">        EulerAngles[2] = acos(return3);</span></div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span><span class="comment"></span> </div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span><span class="comment">    }*/</span></div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span> </div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a5d815ee1bd1baa359992407bb97b8fa7">  939</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span>  <span class="keywordtype">bool</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a5d815ee1bd1baa359992407bb97b8fa7">InsideOutside</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; Coord1,</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span>                                      <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; Coord2,</div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>                                      <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; JudgeCoord,</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>                                      <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; normal_element,</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>                                      <span class="keywordtype">double</span>&amp; area){</div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span> </div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>        <span class="comment">//NOTE:: Normal_out here has to be the normal of the element orientation (not pointing particle)</span></div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>        <span class="keywordtype">double</span> b[3];</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>        <span class="keywordtype">double</span> p1[3];</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>        <span class="keywordtype">double</span> coor[3];</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>        <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#aa821daf08950421b2a257e807401346a">DEM_COPY_SECOND_TO_FIRST_3</a>(coor, Coord1)</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>        b[0] = Coord2[0] - coor[0];</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>        b[1] = Coord2[1] - coor[1];</div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>        b[2] = Coord2[2] - coor[2];</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>        p1[0] = JudgeCoord[0] - coor[0];</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>        p1[1] = JudgeCoord[1] - coor[1];</div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>        p1[2] = JudgeCoord[2] - coor[2];</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>        <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a9fe1bbee9061a6d9e432147bd6c78d6b">DEM_SET_TO_CROSS_OF_FIRST_TWO_3</a>(b, p1, coor)</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span> </div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>        <span class="keywordflow">if</span> (<a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a963d27657c723d4127e779af7cd0d952">DEM_INNER_PRODUCT_3</a>(coor, normal_element) &gt;= 0){</div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>            area = 0.5 * <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a33d81a3e79bb06d94c0d6b7ceb3b4c05">DEM_MODULUS_3</a>(coor);</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>        }</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>        <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span> </div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>    }<span class="comment">//InsideOutside</span></div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span> </div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aa98888bc83fb156db2fa6b202f55c721">  966</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a5d815ee1bd1baa359992407bb97b8fa7">InsideOutside</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> &amp;Coord1,</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>                                     <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; Coord2,</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>                                     <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; JudgeCoord,</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>                                     <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; normal_element) {</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span> </div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>        <span class="comment">//NOTE:: Normal_out here has to be the normal of the element orientation (not pointing particle)</span></div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> cp1;</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> b_a;</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> p1_a;</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span> </div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>        <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(b_a)  = Coord2 - Coord1;</div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>        <a class="code hl_function" href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">noalias</a>(p1_a) = JudgeCoord - Coord1;</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span> </div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">GeometryFunctions::CrossProduct</a>(b_a, p1_a, cp1);</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span> </div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae3bbd7194a2ffdee9412e5b3ad716e26">GeometryFunctions::DotProduct</a>(cp1, normal_element) &gt;= 0)</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>        {</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>            <span class="comment">//area = sqrt(cp1[0] * cp1[0] + cp1[1] * cp1[1] + cp1[2] * cp1[2]) * 0.5;</span></div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>        }</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>        <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span> </div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>    }<span class="comment">//InsideOutside</span></div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span> </div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a0b1a8799cac8c1419ffa55034c70dc18">  990</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a0b1a8799cac8c1419ffa55034c70dc18">WeightsCalculation</a>(std::vector&lt;double&gt; Area, std::vector&lt;double&gt;&amp; Weight)</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>    {</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> facet_size = Area.size();</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>        <span class="keywordflow">if</span> (facet_size == 3)</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>        {</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> total_area = Area[0]+Area[1]+Area[2];</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> inv_total_area = 1.0 / total_area;</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i&lt; 3; i++)</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>            {</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>                Weight[i] = Area[(i+1)%facet_size] * inv_total_area;</div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>            }</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>        }</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (facet_size == 4)</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>        {</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> total_discriminant = Area[0]*Area[1]+Area[1]*Area[2]+Area[2]*Area[3]+Area[3]*Area[0]; <span class="comment">//(Zhong et al 1993)</span></div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> inv_total_discriminant = 1.0 / total_discriminant;</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i&lt; 4; i++)</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>            {</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>                Weight[i] = (Area[(i+1)%facet_size]*Area[(i+2)%facet_size]) * inv_total_discriminant;</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>            }</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>        }</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>        <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>            <a class="code hl_define" href="../../df/d67/define_8h.html#a6135b00508a42f0e8f91d1369644cbc1">KRATOS_WATCH</a>(<span class="stringliteral">&quot;WEIGHTS FOR N-SIZE POLYGONAL FE TO BE IMPLEMENTED&quot;</span>)</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>        }</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>    }<span class="comment">//WeightsCalculation</span></div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span> </div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a18c3b7ac56a9b8e96b126027cff9f8e8"> 1016</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a18c3b7ac56a9b8e96b126027cff9f8e8">FastFacetCheck</a>(<span class="keyword">const</span> std::vector&lt; array_1d &lt;double,3&gt; &gt;&amp; Coord, <span class="keyword">const</span> array_1d &lt;double,3&gt;&amp; Particle_Coord, <span class="keywordtype">double</span> rad, <span class="keywordtype">double</span> &amp;DistPToB, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;current_edge_index)</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>    {</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>        <span class="keywordtype">double</span> A[3];</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>        <span class="keywordtype">double</span> B[3];</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>        <span class="keywordtype">double</span> PC[3];</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span> </div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 3; i++){</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>            B[i]  = Coord[0][i];</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>            PC[i] = Coord[1][i];</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>            A[i]  = Coord[2][i];</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>        }</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span> </div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 3; i++){</div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>            A[i] = A[i] - PC[i];</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>            B[i] = B[i] - PC[i];</div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>            PC[i] = Particle_Coord[i] - PC[i];</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>        }</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span> </div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>        <span class="comment">//Calculate Normal</span></div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span> </div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>        <span class="keywordtype">double</span> N_fast[3];</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>        <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a9fe1bbee9061a6d9e432147bd6c78d6b">DEM_SET_TO_CROSS_OF_FIRST_TWO_3</a>(A, B, N_fast)</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>        <span class="comment">//normalize</span></div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span> </div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>        <span class="keywordtype">double</span> normal_flag = 1.0;</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span> </div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>        <span class="keywordflow">if</span> (<a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a963d27657c723d4127e779af7cd0d952">DEM_INNER_PRODUCT_3</a>(PC, N_fast) &lt; 0){ <span class="comment">//it is assumed that Indentation wont be greater than radius so we can detect contacts on both sides of the FE.</span></div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>            normal_flag = -1.0;</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>        }</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span> </div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>(N_fast);</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span> </div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>        <span class="comment">//Calculate distance:</span></div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span> </div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>        DistPToB = 0.0;</div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span> </div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 3; i++){</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>            DistPToB += normal_flag * N_fast[i] * PC[i];</div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>        }</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span> </div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>        <span class="keywordflow">if</span> (DistPToB &lt; rad){</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>            array_1d &lt;double, 3&gt; IntersectionCoord;</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>            array_1d &lt;double, 3&gt; <a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>;</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span> </div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 3; i++){</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>                IntersectionCoord[i] = Particle_Coord[i] - DistPToB * normal_flag * N_fast[i];</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>                <a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>[i] = N_fast[i];</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>            }</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span> </div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>            <span class="keywordtype">int</span> facet_size = Coord.size();</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span> </div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; facet_size; i++) {</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>                <span class="keywordtype">double</span> this_area = 0.0;</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span> </div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a5d815ee1bd1baa359992407bb97b8fa7">InsideOutside</a>(Coord[i], Coord[(i+1)%facet_size], IntersectionCoord, <a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>, this_area) == <span class="keyword">false</span>){</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>                    current_edge_index = i;</div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>                }</div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>            }</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>        }<span class="comment">//if DistPToB &lt; rad</span></div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span> </div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>    }<span class="comment">//FastFacetCheck</span></div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span> </div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a8bc9419a30174c9727e9024f95bb669e"> 1081</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a8bc9419a30174c9727e9024f95bb669e">FacetCheck</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../dc/dea/class_kratos_1_1_geometry.html">GeometryType</a>&amp;  Coord, <span class="keyword">const</span> array_1d &lt;double,3&gt;&amp; Particle_Coord, <span class="keywordtype">double</span> rad,</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>                                  <span class="keywordtype">double</span> LocalCoordSystem[3][3], <span class="keywordtype">double</span>&amp; DistPToB, std::vector&lt;double&gt;&amp; Weight, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; current_edge_index, <span class="keywordtype">bool</span>&amp; inside)</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>    {</div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>        <span class="keywordtype">int</span> facet_size = Coord.<a class="code hl_function" href="../../dc/dea/class_kratos_1_1_geometry.html#a2477b702b7e4972903ca29e31b6ded56">size</a>();</div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>        <span class="comment">//Calculate Normal</span></div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span> </div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>        array_1d &lt;double,3&gt; A;</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>        array_1d &lt;double,3&gt; B;</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>        array_1d &lt;double,3&gt; <a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>;</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>        array_1d &lt;double,3&gt; PC;</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span> </div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i&lt;3; i++)</div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>        {</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>            A[i] = Coord[2].Coordinates()[i]-Coord[1].Coordinates()[i];</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>            B[i] = Coord[0].Coordinates()[i]-Coord[1].Coordinates()[i];</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>            PC[i] = Particle_Coord[i]-Coord[1].Coordinates()[i];</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>        }</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span> </div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>        <a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>[0] = A[1]*B[2] - A[2]*B[1];</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>        <a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>[1] = A[2]*B[0] - A[0]*B[2];</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>        <a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>[2] = A[0]*B[1] - A[1]*B[0];</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>        <span class="comment">//normalize</span></div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span> </div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>        <span class="keywordtype">double</span> normal_flag = 1.0;</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span> </div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae3bbd7194a2ffdee9412e5b3ad716e26">DotProduct</a>(PC,<a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>) &lt; 0) <span class="comment">//it is assumed that Indentation wont be greater than radius so we can detect contacts on both sides of the FE.</span></div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>        {</div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>            normal_flag = - 1.0;</div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>            <a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>[0]=-<a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>[0];</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>            <a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>[1]=-<a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>[1];</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>            <a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>[2]=-<a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>[2];</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>        }</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>(<a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>);</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span> </div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>        <span class="comment">//Calculate distance:</span></div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span> </div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>        DistPToB = 0.0;</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span> </div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i&lt;3; i++)</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>        {</div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>            DistPToB += <a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>[i]*PC[i];</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>        }</div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span> </div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>        <span class="comment">// Check if particle is inside Finite Element (even if contact is not possible, i.e. DistPToB &gt;= rad)</span></div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>            array_1d &lt;double,3&gt; IntersectionCoord;</div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span> </div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i&lt;3; i++)</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>            {</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>                IntersectionCoord[i] = Particle_Coord[i] - DistPToB*<a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>[i];</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>            }</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span> </div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>            std::vector&lt;double&gt; Area;</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>            Area.resize(facet_size);</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span> </div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i&lt;facet_size; i++)</div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>            {</div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>                <span class="keywordtype">double</span> this_area = 0.0;</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a5d815ee1bd1baa359992407bb97b8fa7">InsideOutside</a>(Coord[i],</div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span>                                  Coord[(i+1)%facet_size],</div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>                                  IntersectionCoord,</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>                                  normal_flag*<a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>,</div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>                                  this_area) == <span class="keyword">false</span>)</div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>                {</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>                    current_edge_index = i;</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>                    inside = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>                }</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>                <span class="keywordflow">else</span></div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>                {</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>                    inside = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>                    Area[i] = this_area; <span class="comment">//the area adjacent to vertex[ID] is assigned as Area[ID] so further treatment shall be done for the Weight calculation</span></div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>                }</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span> </div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>            }<span class="comment">//for every vertex</span></div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span> </div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span>        <span class="keywordflow">if</span> (DistPToB &lt; rad)</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>        {</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>            <span class="keywordtype">double</span> auxiliar_unit_vector[3];</div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>            <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">CrossProduct</a>( <a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>,A,auxiliar_unit_vector );</div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>            <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>( auxiliar_unit_vector );</div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>            <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>( A );</div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j&lt;3; j++)</div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>            {</div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>                LocalCoordSystem[0][j] = A[j];</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>                LocalCoordSystem[1][j] = auxiliar_unit_vector[j];</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>                LocalCoordSystem[2][j] = <a class="code hl_variable" href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a>[j];</div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>            }</div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span> </div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span>            <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a0b1a8799cac8c1419ffa55034c70dc18">WeightsCalculation</a>(Area,Weight);</div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span> </div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span>        }<span class="comment">//if DistPToB &lt; rad</span></div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span> </div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span> </div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>    } <span class="comment">//FacetCheck</span></div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span> </div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a53a533bbfbaf2c440fcdcf78bb69c8af"> 1178</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a53a533bbfbaf2c440fcdcf78bb69c8af">FastEdgeVertexCheck</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; Coord1, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; Coord2, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; Particle_Coord, <span class="keywordtype">double</span> Radius)</div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>    {</div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>        <span class="keywordtype">double</span> IntersectionCoordEdge[3];</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>        <span class="keywordtype">double</span> normal_unit_vector[3];</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>        <span class="keywordtype">double</span> edge_unit_vector[3];</div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>        <span class="keywordtype">double</span> module_edge_vector = 0.0;</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>        <span class="keywordtype">double</span> particle_vector1[3];</div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>        <span class="keywordtype">double</span> particle_vector2[3];</div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span> </div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j&lt;3; j++)</div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>        {</div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>            edge_unit_vector[j] = Coord2[j] - Coord1[j];</div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>            particle_vector1[j]  = Particle_Coord[j] - Coord1[j];</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>            particle_vector2[j]  = Particle_Coord[j] - Coord2[j];</div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>        }</div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span> </div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>( edge_unit_vector, module_edge_vector);</div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>        <span class="keywordtype">double</span> projection_on_edge = <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae3bbd7194a2ffdee9412e5b3ad716e26">DotProduct</a>(particle_vector1,edge_unit_vector);</div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span> </div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>        <span class="keywordtype">double</span> eta = projection_on_edge/module_edge_vector;</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span> </div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span>        <span class="keywordflow">if</span> ((eta&gt;=0.0) &amp;&amp; (eta&lt;=1.0)) <span class="comment">//can only be edge, no vertex</span></div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>        {</div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j&lt;3; j++)</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>            {</div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>                IntersectionCoordEdge[j] = Coord1[j] + projection_on_edge*edge_unit_vector[j];</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>                normal_unit_vector[j]   = Particle_Coord[j] - IntersectionCoordEdge[j];</div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>            }</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span> </div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>            <span class="keywordtype">double</span> DistParticleToEdge;</div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span>            <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>( normal_unit_vector, DistParticleToEdge);</div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span> </div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>            <span class="keywordflow">if</span> (DistParticleToEdge &lt; Radius)</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>            {</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span>            }</div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>        }</div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span> </div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>        <span class="keywordflow">if</span> (eta &lt; 0.0)  <span class="comment">//1rst Vertex</span></div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>        {</div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>            <span class="keywordtype">double</span> dist_to_vertex_sq = 0.0;</div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>            <span class="keywordtype">double</span> Rad_sq = Radius*Radius;</div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span> </div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j&lt;3; j++)</div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>            {</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>                dist_to_vertex_sq +=particle_vector1[j]*particle_vector1[j];</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>            }</div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span> </div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span>            <span class="keywordflow">if</span> (dist_to_vertex_sq &lt; Rad_sq)</div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>            {</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span>            }</div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span>        }</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span> </div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>        <span class="keywordflow">if</span> (eta &gt; 1.0)  <span class="comment">//2n vertex</span></div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>        {</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>            <span class="keywordtype">double</span> dist_to_vertex_sq = 0.0;</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>            <span class="keywordtype">double</span> Rad_sq = Radius*Radius;</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j&lt;3; j++)</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>            {</div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span>                dist_to_vertex_sq +=particle_vector2[j]*particle_vector2[j];</div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>            }</div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span> </div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>            <span class="keywordflow">if</span> (dist_to_vertex_sq &lt; Rad_sq)</div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>            {</div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>            }</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>        }</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span> </div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span> </div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>    }<span class="comment">//FastEdgeVertexCheck;</span></div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span> </div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a299b87fdd0db45abd51d1b7e06e16d04"> 1251</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a299b87fdd0db45abd51d1b7e06e16d04">EdgeCheck</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; Coord1, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; Coord2, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; Particle_Coord, <span class="keywordtype">double</span> Radius,</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>                                  <span class="keywordtype">double</span> LocalCoordSystem[3][3], <span class="keywordtype">double</span>&amp; DistParticleToEdge, <span class="keywordtype">double</span>&amp; eta)</div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span>    {</div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>        <span class="keywordtype">double</span> IntersectionCoordEdge[3];</div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>        <span class="keywordtype">double</span> normal_unit_vector[3];</div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span>        <span class="keywordtype">double</span> edge_unit_vector[3];</div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>        <span class="keywordtype">double</span> module_edge_vector = 0.0;</div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>        <span class="keywordtype">double</span> particle_vector[3];</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span> </div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j&lt;3; j++)</div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>        {</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>            edge_unit_vector[j] = Coord2[j] - Coord1[j];</div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span>            particle_vector[j]  = Particle_Coord[j] - Coord1[j];</div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span>        }</div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span> </div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>(edge_unit_vector, module_edge_vector);</div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>        <span class="keywordtype">double</span> projection_on_edge = <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae3bbd7194a2ffdee9412e5b3ad716e26">DotProduct</a>(particle_vector,edge_unit_vector);</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span> </div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j&lt;3; j++)</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span>        {</div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span>            IntersectionCoordEdge[j] = Coord1[j] + projection_on_edge*edge_unit_vector[j];</div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>            normal_unit_vector[j]   = Particle_Coord[j] - IntersectionCoordEdge[j];</div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span>        }</div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span> </div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>( normal_unit_vector, DistParticleToEdge);</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span> </div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span>        eta = projection_on_edge / module_edge_vector;</div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span> </div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span>        <span class="keywordflow">if</span> (DistParticleToEdge &lt; Radius)</div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span>        {</div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span>            <span class="keywordflow">if</span> ((eta&gt;=0.0) &amp;&amp; (eta&lt;=1.0))</div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span>            {</div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span>                <span class="keywordtype">double</span> dummy_length = 0.0;</div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span>                <span class="keywordtype">double</span> auxiliar_unit_vector[3];</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span>                <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">CrossProduct</a>(normal_unit_vector,edge_unit_vector,auxiliar_unit_vector);</div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span>                <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>(auxiliar_unit_vector, dummy_length);</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span> </div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j&lt;3; j++)</div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>                {</div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>                    LocalCoordSystem[0][j] = edge_unit_vector[j];</div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span>                    LocalCoordSystem[1][j] = auxiliar_unit_vector[j];</div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>                    LocalCoordSystem[2][j] = normal_unit_vector[j];</div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>                }</div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span> </div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>            }</div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span>        } <span class="comment">//if distance to edge &lt; radius</span></div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span> </div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span> </div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span>    }<span class="comment">//EdgeCheck</span></div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span> </div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a86caa4144e4384c0c7b1c292505a58c9"> 1303</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a86caa4144e4384c0c7b1c292505a58c9">VertexCheck</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; Coord, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; Particle_Coord, <span class="keywordtype">double</span> Radius, <span class="keywordtype">double</span> LocalCoordSystem[3][3], <span class="keywordtype">double</span>&amp; DistParticleToVertex)</div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span>    {</div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span>        <span class="keywordtype">double</span> dist_sq = 0.0;</div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> normal_v;</div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span>        {</div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span>            normal_v[j] = Particle_Coord[j] - Coord[j];</div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>            dist_sq += normal_v[j] * normal_v[j];</div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span>        }</div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span>        <span class="keywordflow">if</span> (dist_sq &lt;= Radius * Radius)</div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span>        {</div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span>            DistParticleToVertex = sqrt(dist_sq);</div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>            <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a39f63df8ff12dd40eb983fc7562d7015">ComputeContactLocalCoordSystem</a>(normal_v, DistParticleToVertex, LocalCoordSystem);</div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span>        }</div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span>    }<span class="comment">//VertexCheck</span></div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span> </div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span> </div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a1d09f932b41cbb89029b69eba942a631"> 1322</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a1d09f932b41cbb89029b69eba942a631">FastVertexCheck</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; Coord, <span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double,3&gt;</a>&amp; Particle_Coord, <span class="keywordtype">double</span> Radius)</div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>    {</div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>        <span class="keywordtype">double</span> dist_sq = 0.0;</div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span>        <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a> normal_v;</div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>        {</div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span>            normal_v[j] = Particle_Coord[j] - Coord[j];</div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>            dist_sq += normal_v[j] * normal_v[j];</div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>        }</div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span>        <span class="keywordflow">if</span> (dist_sq &lt;= Radius * Radius) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>    }<span class="comment">//FastVertexCheck</span></div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span> </div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span>    <span class="comment">/*static inline void Coord_transform(double origin[3], double coordsystem[3][3], double Coord[3], double TransCoord[3])</span></div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span><span class="comment">    {</span></div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span><span class="comment">        TransCoord[0]=0.0;</span></div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span><span class="comment">        TransCoord[1]=0.0;</span></div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span><span class="comment">        TransCoord[2]=0.0;</span></div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span><span class="comment">        double vector[3];</span></div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span><span class="comment">        vector[0]=Coord[0] - origin[0];</span></div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span><span class="comment">        vector[1]=Coord[1] - origin[1];</span></div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span><span class="comment">        vector[2]=Coord[2] - origin[2];</span></div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span><span class="comment">        TransCoord[0]=DotProduct(coordsystem[0],vector);</span></div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span><span class="comment">        TransCoord[1]=DotProduct(coordsystem[1],vector);</span></div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span><span class="comment">        TransCoord[2]=DotProduct(coordsystem[2],vector);</span></div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span><span class="comment">    }*/</span></div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span> </div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>    <span class="comment">/*static inline void N44(double xp,double yp,double xy[4][2],double&amp; N1,double&amp; N2,double&amp; N3,double&amp; N4)</span></div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span><span class="comment">    {</span></div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span><span class="comment">        double xc=(xy[0][0]+xy[1][0]+xy[2][0]+xy[3][0])/4.0;</span></div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span><span class="comment">        double yc=(xy[0][1]+xy[1][1]+xy[2][1]+xy[3][1])/4.0;</span></div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span><span class="comment"></span> </div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span><span class="comment">        double elelength_x=2.0*fabs(xy[0][0]-xc);</span></div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span><span class="comment">        double elelength_y=2.0*fabs(xy[0][1]-yc);</span></div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span><span class="comment"></span> </div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span><span class="comment">        double Eps,Ita;</span></div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span><span class="comment">        Eps=2.0*(xp-xc)/elelength_x;</span></div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span><span class="comment">        Ita=2.0*(yp-yc)/elelength_y;</span></div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span><span class="comment">        N1=0.25*(1+Eps*2*(xy[0][0]-xc)/elelength_x)*(1+Ita*2*(xy[0][1]-yc)/elelength_y);</span></div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span><span class="comment">        N2=0.25*(1+Eps*2*(xy[1][0]-xc)/elelength_x)*(1+Ita*2*(xy[1][1]-yc)/elelength_y);</span></div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span><span class="comment">        N3=0.25*(1+Eps*2*(xy[2][0]-xc)/elelength_x)*(1+Ita*2*(xy[2][1]-yc)/elelength_y);</span></div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span><span class="comment">        N4=0.25*(1+Eps*2*(xy[3][0]-xc)/elelength_x)*(1+Ita*2*(xy[3][1]-yc)/elelength_y);</span></div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span><span class="comment">    }*/</span></div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span> </div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span>    <span class="comment">//Cfeng: irregular quadrilateral transfer to regular quadrilateral</span></div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span>    <span class="comment">/*static inline void gl_to_iso(double x0, double y0, double xy[4][2], double&amp; x_exisp, double&amp; y_etasp)</span></div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span><span class="comment">    {</span></div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span><span class="comment">        double exisp=0.0;</span></div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span><span class="comment">        double etasp=0.0;</span></div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span><span class="comment">        double tolerance=1.0e-8;</span></div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span><span class="comment">        double x,y,x1,x2,x3,x4,y1,y2,y3,y4,a1,a2,a3,a4,b1,b2,b3,b4,s1,t1,d1,g1,g2,g0;</span></div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span><span class="comment">        x1 = xy[0][0];</span></div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span><span class="comment">        x2 = xy[1][0];</span></div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span><span class="comment">        x3 = xy[2][0];</span></div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span><span class="comment">        x4 = xy[3][0];</span></div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span><span class="comment">        y1 = xy[0][1];</span></div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span><span class="comment">        y2 = xy[1][1];</span></div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span><span class="comment">        y3 = xy[2][1];</span></div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span><span class="comment">        y4 = xy[3][1];</span></div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span><span class="comment">        a1=0.25*(-x1+x2+x3-x4);</span></div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span><span class="comment">        a2=0.25*(x1-x2+x3-x4);</span></div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span><span class="comment">        a3=0.25*(-x1-x2+x3+x4);</span></div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span><span class="comment">        a4=0.25*(x1+x2+x3+x4);</span></div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span><span class="comment">        b1=0.25*(-y1+y2+y3-y4);</span></div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span><span class="comment">        b2=0.25*(y1-y2+y3-y4);</span></div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span><span class="comment">        b3=0.25*(-y1-y2+y3+y4);</span></div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span><span class="comment">        b4=0.25*(y1+y2+y3+y4);</span></div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span><span class="comment"></span> </div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span><span class="comment">        x = x0 - a4;</span></div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span><span class="comment">        y = y0 - b4;</span></div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span><span class="comment">        s1 = a2*b3 - a3*b2;</span></div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span><span class="comment">        t1 = b2*x - a2*y + a1*b3 - a3*b1;</span></div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span><span class="comment">        d1 = b1*x - a1*y;</span></div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span><span class="comment"></span> </div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span><span class="comment">        if (fabs(s1) &lt; tolerance)</span></div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span><span class="comment">        {</span></div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span><span class="comment">            etasp = -d1/t1;</span></div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span><span class="comment">            exisp = (x-a3*etasp) / (a1+a2*etasp);</span></div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span><span class="comment">        }</span></div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span><span class="comment">        else</span></div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span><span class="comment">        {</span></div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span><span class="comment">            const double sqrt_aux = sqrt(t1*t1-4*s1*d1);</span></div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span><span class="comment">            g1 = (-t1 + sqrt_aux) / (2*s1);</span></div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span><span class="comment">            g2 = (-t1 - sqrt_aux) / (2*s1);</span></div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span><span class="comment">            if (fabs(g1) &lt; 1.0+tolerance)</span></div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span><span class="comment">            {</span></div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span><span class="comment">                g0 = (x-a3*g1) / (a1+a2*g1);</span></div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span><span class="comment">                if (fabs(g0) &lt; 1.0+tolerance)</span></div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span><span class="comment">                {</span></div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span><span class="comment">                    etasp = g1;</span></div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span><span class="comment">                    exisp = g0;</span></div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span><span class="comment">                }</span></div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span><span class="comment">            }</span></div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span><span class="comment">            if(fabs(g2) &lt; 1.0+tolerance)</span></div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span><span class="comment">            {</span></div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span><span class="comment">                g0 = (x-a3*g2) / (a1+a2*g2);</span></div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span><span class="comment">                if(fabs(g0) &lt; 1.0+tolerance)</span></div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span><span class="comment">                {</span></div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span><span class="comment">                    etasp = g2;</span></div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span><span class="comment">                    exisp = g0;</span></div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span><span class="comment">                }</span></div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span><span class="comment">            }</span></div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span><span class="comment">        }</span></div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span><span class="comment">        x_exisp=exisp;</span></div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span><span class="comment">        y_etasp=etasp;</span></div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span><span class="comment">    }*/</span></div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span> </div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span>    <span class="comment">/*static void CalQuadWeightCoefficient(double Coord[4][3], double LocalCoordSystem[3][3], double IntersectionCoord[3], double Weight[4])</span></div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span><span class="comment">    {</span></div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span><span class="comment"></span> </div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span><span class="comment"></span> </div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span><span class="comment">        int j;</span></div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span><span class="comment"></span> </div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span><span class="comment">        double FaceCenter[3] = {0.0};</span></div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span><span class="comment">        for(j = 0; j &lt; 4; j++)</span></div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span><span class="comment">        {</span></div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span><span class="comment">            FaceCenter[0] += Coord[j][0] * 0.25;</span></div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span><span class="comment">            FaceCenter[1] += Coord[j][1] * 0.25;</span></div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span><span class="comment">            FaceCenter[2] += Coord[j][2] * 0.25;</span></div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span><span class="comment">        }</span></div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span><span class="comment"></span> </div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span><span class="comment">        double TransCoord0[3],TransCoord1[3],TransCoord2[3],TransCoord3[3];</span></div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span><span class="comment">        double xy[4][2];</span></div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span><span class="comment">        double xy1[4][2]={{-1.0,-1.0},{1.0,-1.0},{1.0,1.0},{-1.0,1.0}};</span></div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span><span class="comment"></span> </div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span><span class="comment"></span> </div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span><span class="comment">        double TempLocalCoordSystem[3][3]={{0.0}, {0.0}, {0.0}};</span></div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span><span class="comment">        double vx[3]={1.0,0,0},vy[3]={0,1.0,0},vz[3]={0, 0, 1.0};</span></div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span><span class="comment"></span> </div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span><span class="comment">        if( DotProduct(LocalCoordSystem[2],vx)&lt;0 || DotProduct(LocalCoordSystem[2],vy)&lt;0 || DotProduct(LocalCoordSystem[2],vz)&lt;0 )</span></div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span><span class="comment">        {</span></div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span><span class="comment">            for(j=0;j&lt;3;j++)</span></div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span><span class="comment">            {</span></div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span><span class="comment">                TempLocalCoordSystem[0][j] =  LocalCoordSystem[0][j];</span></div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span><span class="comment">                TempLocalCoordSystem[1][j] =  LocalCoordSystem[1][j];</span></div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span><span class="comment">                TempLocalCoordSystem[2][j] = -LocalCoordSystem[2][j];</span></div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span><span class="comment">            }</span></div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span><span class="comment">        }</span></div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span><span class="comment"></span> </div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span><span class="comment"></span> </div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span><span class="comment"></span> </div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span><span class="comment">        else</span></div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span><span class="comment">        {</span></div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span><span class="comment">            for(j=0;j&lt;3;j++)</span></div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"> 1469</span><span class="comment">            {</span></div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span><span class="comment">                TempLocalCoordSystem[0][j] = LocalCoordSystem[0][j];</span></div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span><span class="comment">                TempLocalCoordSystem[1][j] = LocalCoordSystem[1][j];</span></div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span><span class="comment">                TempLocalCoordSystem[2][j] = LocalCoordSystem[2][j];</span></div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span><span class="comment">            }</span></div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span><span class="comment">        }</span></div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span><span class="comment"></span> </div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span><span class="comment"></span> </div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span><span class="comment">        Coord_transform(FaceCenter, TempLocalCoordSystem, Coord[0], TransCoord0);</span></div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span><span class="comment">        Coord_transform(FaceCenter, TempLocalCoordSystem, Coord[1], TransCoord1);</span></div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span><span class="comment">        Coord_transform(FaceCenter, TempLocalCoordSystem, Coord[2], TransCoord2);</span></div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span><span class="comment">        Coord_transform(FaceCenter, TempLocalCoordSystem, Coord[3], TransCoord3);</span></div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span><span class="comment"></span> </div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span><span class="comment"></span> </div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span><span class="comment">        xy[0][0] = TransCoord0[0]; xy[0][1] = TransCoord0[1];</span></div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span><span class="comment">        xy[1][0] = TransCoord1[0]; xy[1][1] = TransCoord1[1];</span></div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span><span class="comment">        xy[2][0] = TransCoord2[0]; xy[2][1] = TransCoord2[1];</span></div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span><span class="comment">        xy[3][0] = TransCoord3[0]; xy[3][1] = TransCoord3[1];</span></div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span><span class="comment"></span> </div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span><span class="comment">        double in0=0.0, in1=0.0, in2=0.0, in3=0.0;</span></div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span><span class="comment">        double TransCoordp[3];</span></div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span><span class="comment">        double Coordp_iso[2];</span></div>
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"> 1491</span><span class="comment"></span> </div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"> 1492</span><span class="comment"></span> </div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"> 1493</span><span class="comment">        Coord_transform(FaceCenter, TempLocalCoordSystem, IntersectionCoord, TransCoordp);</span></div>
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"> 1494</span><span class="comment"></span> </div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"> 1495</span><span class="comment">        gl_to_iso(TransCoordp[0],TransCoordp[1],xy,Coordp_iso[0],Coordp_iso[1]);</span></div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"> 1496</span><span class="comment"></span> </div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"> 1497</span><span class="comment">        N44(Coordp_iso[0],Coordp_iso[1], xy1, in0, in1, in2, in3);</span></div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"> 1498</span><span class="comment"></span> </div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"> 1499</span><span class="comment">        Weight[0]=in0;</span></div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span><span class="comment">        Weight[1]=in1;</span></div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span><span class="comment">        Weight[2]=in2;</span></div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span><span class="comment">        Weight[3]=in3;</span></div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span><span class="comment"></span> </div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span><span class="comment"></span> </div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span><span class="comment"></span> </div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span><span class="comment">    }*/</span></div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span> </div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span> </div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a9f9a6dc92324d6707aee78da6b05f84d"> 1512</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a9f9a6dc92324d6707aee78da6b05f84d">GetRotationMatrix</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; EulerAngles, <span class="keywordtype">double</span> rotation_matrix[3][3]) {</div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span> </div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span>        <span class="keywordtype">double</span> cosA=cos(EulerAngles[0]);</div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span>        <span class="keywordtype">double</span> sinA=sin(EulerAngles[0]);</div>
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"> 1516</span>        <span class="keywordtype">double</span> cosB=cos(EulerAngles[1]);</div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"> 1517</span>        <span class="keywordtype">double</span> sinB=sin(EulerAngles[1]);</div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span>        <span class="keywordtype">double</span> cosC=cos(EulerAngles[2]);</div>
<div class="line"><a id="l01519" name="l01519"></a><span class="lineno"> 1519</span>        <span class="keywordtype">double</span> sinC=sin(EulerAngles[2]);</div>
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"> 1520</span> </div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span>        rotation_matrix[0][0] = cosC*cosA - cosB*sinA*sinC;</div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span>        rotation_matrix[0][1] = -sinC*cosA - cosB*sinA*cosC;</div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span>        rotation_matrix[0][2] = sinB*sinA;</div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span>        rotation_matrix[1][0] = cosC*sinA + cosB*cosA*sinC;</div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span>        rotation_matrix[1][1] = -sinC*sinA + cosB*cosA*cosC;</div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"> 1526</span>        rotation_matrix[1][2] = -sinB*cosA;</div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span>        rotation_matrix[2][0] = sinC*sinB;</div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span>        rotation_matrix[2][1] = cosC*sinB;</div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span>        rotation_matrix[2][2] = cosB;</div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span> </div>
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"> 1531</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span>    }</div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span> </div>
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a5c2e6fe59d0e42509db6e46b320548da"> 1534</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a5c2e6fe59d0e42509db6e46b320548da">GetEulerAngles</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> rotation_matrix[3][3], <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3 &gt;</a> &amp; EulerAngles)</div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span>    {</div>
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"> 1536</span>        <span class="keywordflow">if</span> (rotation_matrix[2][2] &lt; 1.0)</div>
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"> 1537</span>        {</div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span>            <span class="keywordflow">if</span> (rotation_matrix[2][2] &gt; -1.0) {</div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span>                EulerAngles[0] = atan2(rotation_matrix[0][2], -rotation_matrix[1][2]);</div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"> 1540</span>                EulerAngles[1] = acos(rotation_matrix[2][2]);</div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span>                EulerAngles[2] = atan2(rotation_matrix[2][0], rotation_matrix[2][1]);</div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span>            }</div>
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"> 1543</span>            <span class="keywordflow">else</span> <span class="comment">// r22 = -1</span></div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span>            {</div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span>                <span class="comment">// Not a unique solution: thetaZ1 - thetaZ0 = atan2(-r01,r00)</span></div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span>                EulerAngles[0] = -atan2(-rotation_matrix[0][1], rotation_matrix[0][0]);</div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span>                EulerAngles[1] = <a class="code hl_variable" href="../../d5/dc0/namespace_kratos_1_1_globals.html#ae57da311aaf349aa883363f673e534fc">Globals::Pi</a>;</div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span>                EulerAngles[2] = 0;</div>
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"> 1549</span>            }</div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span>        }</div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span>        <span class="keywordflow">else</span> <span class="comment">// r22 = +1</span></div>
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"> 1552</span>        {</div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span>            <span class="comment">// Not a unique solution: thetaZ1 + thetaZ0 = atan2(-r01,r00)</span></div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span>            EulerAngles[0] = atan2(-rotation_matrix[0][1], rotation_matrix[0][0]);</div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span>            EulerAngles[1] = 0;</div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span>            EulerAngles[2] = 0;</div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span>        }</div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span> </div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"> 1560</span>    }</div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span> </div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a283ea24b4791dfdfa288f28dbce94bd8"> 1562</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a283ea24b4791dfdfa288f28dbce94bd8">GetGiDEulerAngles</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">BoundedMatrix&lt;double, 3, 3&gt;</a>&amp; rotation_matrix, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; EulerAngles) {</div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span>        <span class="keyword">const</span> <span class="keywordtype">double</span> numerical_limit = std::numeric_limits&lt;double&gt;::epsilon();</div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span>        <span class="keyword">const</span> <span class="keywordtype">double</span> two_pi = 3.1415926535897932384626433 * 2.0;</div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span>        <span class="keywordflow">if</span>(rotation_matrix(2, 2)&lt;1.0-numerical_limit &amp;&amp; rotation_matrix(2, 2)&gt;-1.0+numerical_limit){</div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> senb=sqrt(1.0-rotation_matrix(2, 2)*rotation_matrix(2, 2));</div>
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"> 1567</span>            EulerAngles[1]=acos(rotation_matrix(2, 2));</div>
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"> 1568</span>            EulerAngles[2]=acos(rotation_matrix(1, 2)/senb);</div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span>            <span class="keywordflow">if</span>(rotation_matrix(0, 2)/senb&lt;0.0) EulerAngles[2]=two_pi - EulerAngles[2];</div>
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"> 1570</span>            EulerAngles[0]=acos(-rotation_matrix(2, 1)/senb);</div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span>            <span class="keywordflow">if</span>(rotation_matrix(2, 0)/senb&lt;0.0) EulerAngles[0]=two_pi - EulerAngles[0];</div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span>            <span class="comment">// fixed a=0.0 (arbitrary)</span></div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span>            EulerAngles[1]=acos(rotation_matrix(2, 2));</div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span>            EulerAngles[0]=0.0;</div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span>            EulerAngles[2]=acos(rotation_matrix(0, 0));</div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span>            <span class="keywordflow">if</span>(-rotation_matrix(1, 0)&lt;0.0) EulerAngles[2]=two_pi - EulerAngles[2];</div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span>        }</div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span>    }</div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span> </div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aad62f5cfe6d8bcc83ec7b0545ed03f87"> 1581</a></span>    <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aad62f5cfe6d8bcc83ec7b0545ed03f87">QuaternionToGiDEulerAngles</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/de5/class_kratos_1_1_quaternion.html">Quaternion&lt;double&gt;</a>&amp; quaternion, <a class="code hl_class" href="../../d4/ddc/class_kratos_1_1array__1d.html">array_1d&lt;double, 3&gt;</a>&amp; EulerAngles) {</div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"> 1582</span>        <a class="code hl_class" href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">BoundedMatrix&lt;double, 3, 3&gt;</a> rotation_matrix = <a class="code hl_typedef" href="../../db/d66/namespace_kratos.html#a358df20da9726efb77013692eb628f08">ZeroMatrix</a>(3,3);</div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span>        quaternion.<a class="code hl_function" href="../../da/de5/class_kratos_1_1_quaternion.html#a242b17e9f106df2c77b6a3fae3a6f549">ToRotationMatrix</a>(rotation_matrix);</div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a283ea24b4791dfdfa288f28dbce94bd8">GetGiDEulerAngles</a>(rotation_matrix, EulerAngles);</div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span>    }</div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span> </div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span> </div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afa1405629ee9c79223f163b606151df1"> 1591</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afa1405629ee9c79223f163b606151df1">TriAngleArea</a>(<span class="keywordtype">double</span> Coord1[3], <span class="keywordtype">double</span> Coord2[3], <span class="keywordtype">double</span> Coord3[3], <span class="keywordtype">double</span>&amp; area)</div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span>    {</div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span>        <span class="keywordtype">int</span> k;</div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span>        <span class="keywordtype">double</span> Vector1[3],Vector2[3],Vector0[3];</div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span>        <span class="keywordflow">for</span> (k = 0;k &lt; 3; k++)</div>
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"> 1596</span>        {</div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span>            Vector1[k] = Coord3[k] - Coord1[k];</div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span>            Vector2[k] = Coord2[k] - Coord1[k];</div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span>        }</div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span> </div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">CrossProduct</a>(Vector1, Vector2, Vector0);</div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span>        area = 0.5 * <a class="code hl_define" href="../../d9/d06/_d_e_m__application__variables_8h.html#a33d81a3e79bb06d94c0d6b7ceb3b4c05">DEM_MODULUS_3</a>(Vector0);</div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span>    }</div>
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"> 1604</span> </div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span>    <span class="comment">//TriAngle Weight, coord1,coord2,coord3,testcoord,weight</span></div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae1d4ef45066314fc382b7f7886a66388"> 1606</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae1d4ef45066314fc382b7f7886a66388">TriAngleWeight</a>(<span class="keywordtype">double</span> Coord1[3], <span class="keywordtype">double</span> Coord2[3], <span class="keywordtype">double</span> Coord3[3], <span class="keywordtype">double</span> JudgeCoord[3], <span class="keywordtype">double</span> Weight[3])</div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span>    {</div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span>        <span class="keywordtype">double</span> area[3], s;</div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afa1405629ee9c79223f163b606151df1">TriAngleArea</a>(Coord1, Coord2, JudgeCoord, area[0]);</div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afa1405629ee9c79223f163b606151df1">TriAngleArea</a>(Coord2, Coord3, JudgeCoord, area[1]);</div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afa1405629ee9c79223f163b606151df1">TriAngleArea</a>(Coord3, Coord1, JudgeCoord, area[2]);</div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span> </div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afa1405629ee9c79223f163b606151df1">TriAngleArea</a>(Coord1, Coord2, Coord3, s);</div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span>        <span class="keyword">const</span> <span class="keywordtype">double</span> s_inv = 1.0 / s;</div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span>        Weight[0] = area[1] * s_inv;</div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span>        Weight[1] = area[2] * s_inv;</div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span>        Weight[2] = area[0] * s_inv;</div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span>    }</div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span> </div>
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"> 1621</span>    <span class="comment">//Quadrilatera Weight, coord1,coord2,coord3,testcoord,weight (Paper Zhang)</span></div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a63186ad62a225cd7bf47a40a09bf4e5f"> 1622</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a63186ad62a225cd7bf47a40a09bf4e5f">QuadAngleWeight</a>(<span class="keywordtype">double</span> Coord1[3], <span class="keywordtype">double</span> Coord2[3], <span class="keywordtype">double</span> Coord3[3], <span class="keywordtype">double</span> Coord4[3], <span class="keywordtype">double</span> JudgeCoord[3], <span class="keywordtype">double</span> Weight[4])</div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span>    {</div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span>        <span class="keywordtype">double</span> area[4], s1, s2, s;</div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afa1405629ee9c79223f163b606151df1">TriAngleArea</a>(Coord1, Coord2, JudgeCoord, area[0]);</div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afa1405629ee9c79223f163b606151df1">TriAngleArea</a>(Coord2, Coord3, JudgeCoord, area[1]);</div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afa1405629ee9c79223f163b606151df1">TriAngleArea</a>(Coord3, Coord4, JudgeCoord, area[2]);</div>
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"> 1628</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afa1405629ee9c79223f163b606151df1">TriAngleArea</a>(Coord4, Coord1, JudgeCoord, area[3]);</div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span> </div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afa1405629ee9c79223f163b606151df1">TriAngleArea</a>(Coord1, Coord2, Coord3, s1);<span class="comment">//msimsi</span></div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afa1405629ee9c79223f163b606151df1">TriAngleArea</a>(Coord1, Coord3, Coord4, s2);<span class="comment">//msimsi</span></div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span> </div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span>        s = s1 + s2;</div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span> </div>
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"> 1635</span>        <span class="keywordflow">if</span> (fabs(area[0] + area[1] + area[2] + area[3] - s) &lt; 1.0e-15) <span class="comment">//msimsi</span></div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span>        {</div>
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"> 1637</span>            <span class="keywordtype">double</span> QuadNormArea = 1 / ((area[0] + area[2]) * (area[1] + area[3]));</div>
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"> 1638</span> </div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span>            Weight[0] = (area[1] * area[2]) * QuadNormArea;</div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span>            Weight[1] = (area[2] * area[3]) * QuadNormArea;</div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span>            Weight[2] = (area[3] * area[0]) * QuadNormArea;</div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span>            Weight[3] = (area[0] * area[1]) * QuadNormArea;</div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span>        }</div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span>    }</div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span> </div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae1bc980b367fa7f5536b4938cee0f434"> 1646</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae1bc980b367fa7f5536b4938cee0f434">AreaAndCentroidCircularSector</a>(<span class="keywordtype">double</span> C[3], <span class="keywordtype">double</span> Radius, <span class="keywordtype">double</span> P1[3], <span class="keywordtype">double</span> P2[3], <span class="keywordtype">double</span> Normal[3], <span class="keywordtype">double</span>&amp; Area, <span class="keywordtype">double</span> CoMSC[3])</div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span>    {</div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span>        <span class="keywordtype">double</span> a[3]           = {0.0};</div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span>        <span class="keywordtype">double</span> c[3]           = {0.0};</div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span>        <span class="keywordtype">double</span> bisection[3]   = {0.0};</div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span>        <span class="keywordtype">double</span> norm_a         = 0.0;</div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span> </div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = 0;index&lt;3;index++) {</div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span> </div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span>            a[index] = P1[index]-C[index];</div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span>            c[index] = P2[index]-P1[index];</div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span> </div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span>        }</div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span> </div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">CrossProduct</a>(Normal,c,bisection);</div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"> 1661</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>(bisection);</div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span>        <span class="keywordtype">double</span> dot_product = <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae3bbd7194a2ffdee9412e5b3ad716e26">DotProduct</a>(bisection,a);</div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span> </div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span>        <span class="keywordflow">if</span> (dot_product&lt;0.0) {</div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span> </div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = 0;index&lt;3;index++) {</div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"> 1667</span> </div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span>                bisection[index] = -bisection[index];</div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span>            }</div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span> </div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span>            dot_product = -dot_product;</div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span>        }</div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span> </div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a44c5245fc1c0b5505bb15b31a705d8ff">module</a>(a, norm_a);</div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span> </div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span>        <span class="keywordtype">double</span> cos_alpha = dot_product/norm_a;</div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span>        <span class="keywordtype">double</span> alpha = acos(cos_alpha);</div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span>        <span class="keywordtype">double</span> sin_alpha = std::sin(alpha);</div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span> </div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span>        Area = Radius*Radius*alpha;</div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span>        <span class="keywordtype">double</span> dist = 0.66666666666666*(Radius*sin_alpha/alpha);</div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = 0;index&lt;3;index++) {</div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"> 1683</span>            CoMSC[index] = C[index]+dist*bisection[index];</div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span>        }</div>
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"> 1685</span> </div>
<div class="line"><a id="l01686" name="l01686"></a><span class="lineno"> 1686</span>    }<span class="comment">//AreaCircularSector</span></div>
<div class="line"><a id="l01687" name="l01687"></a><span class="lineno"> 1687</span> </div>
<div class="line"><a id="l01688" name="l01688"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a845d535279dafda7a88ef0ed1a23249b"> 1688</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a845d535279dafda7a88ef0ed1a23249b">AlternativeAreaCircularSegment</a>(<span class="keywordtype">double</span> Radius, <span class="keywordtype">double</span> tol_Radius, <span class="keywordtype">double</span> V0V1[3], <span class="keywordtype">double</span> V0CC[3], <span class="keywordtype">double</span> Normal[3], <span class="keywordtype">double</span>&amp; AreaSC, <span class="keywordtype">bool</span>&amp; flag)</div>
<div class="line"><a id="l01689" name="l01689"></a><span class="lineno"> 1689</span>    {</div>
<div class="line"><a id="l01690" name="l01690"></a><span class="lineno"> 1690</span> </div>
<div class="line"><a id="l01691" name="l01691"></a><span class="lineno"> 1691</span>        <span class="keywordtype">double</span> normal_outwards[3] = {0.0};</div>
<div class="line"><a id="l01692" name="l01692"></a><span class="lineno"> 1692</span>        flag = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01693" name="l01693"></a><span class="lineno"> 1693</span>        AreaSC = 0.0;</div>
<div class="line"><a id="l01694" name="l01694"></a><span class="lineno"> 1694</span> </div>
<div class="line"><a id="l01695" name="l01695"></a><span class="lineno"> 1695</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">CrossProduct</a>(V0V1, Normal, normal_outwards);</div>
<div class="line"><a id="l01696" name="l01696"></a><span class="lineno"> 1696</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">normalize</a>(normal_outwards);</div>
<div class="line"><a id="l01697" name="l01697"></a><span class="lineno"> 1697</span> </div>
<div class="line"><a id="l01698" name="l01698"></a><span class="lineno"> 1698</span>        <span class="keywordtype">double</span> dist = <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae3bbd7194a2ffdee9412e5b3ad716e26">DotProduct</a>(normal_outwards,V0CC);</div>
<div class="line"><a id="l01699" name="l01699"></a><span class="lineno"> 1699</span>        <span class="keywordtype">double</span> delta_circle = Radius + dist; <span class="comment">//distance can be positive or negative, depending on the side where the circle is</span></div>
<div class="line"><a id="l01700" name="l01700"></a><span class="lineno"> 1700</span> </div>
<div class="line"><a id="l01701" name="l01701"></a><span class="lineno"> 1701</span>        <span class="keywordflow">if</span> ((delta_circle &gt; tol_Radius) &amp;&amp; (delta_circle - 2*Radius &lt; -tol_Radius)) {<span class="comment">//check for intersection</span></div>
<div class="line"><a id="l01702" name="l01702"></a><span class="lineno"> 1702</span> </div>
<div class="line"><a id="l01703" name="l01703"></a><span class="lineno"> 1703</span>            flag = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"> 1704</span>            <span class="keywordtype">double</span> b = sqrt(delta_circle*(2*Radius-delta_circle));</div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span>            AreaSC   = 2.0*Radius*Radius*atan(delta_circle/b)-b*(Radius-delta_circle);</div>
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"> 1706</span>        }</div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span>    }<span class="comment">//AreaAndCentroidCircularSector1</span></div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span> </div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a6dd6d8ebcb12bb31de7d33ef2bdb1e59"> 1709</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a6dd6d8ebcb12bb31de7d33ef2bdb1e59">AreaAndCentroidCircularSegment</a>(<span class="keywordtype">double</span> Centre[3], <span class="keywordtype">double</span> Radius, <span class="keywordtype">double</span> tol_Radius, <span class="keywordtype">double</span> V0[3], <span class="keywordtype">double</span> V1[3], <span class="keywordtype">double</span> Normal[3], <span class="keywordtype">double</span>&amp; AreaSegC, <span class="keywordtype">double</span> CoMSegC[3], <span class="keywordtype">bool</span>&amp; flag)</div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span>    {</div>
<div class="line"><a id="l01711" name="l01711"></a><span class="lineno"> 1711</span>        <span class="keywordtype">double</span> V0V1[3]            = {0.0};</div>
<div class="line"><a id="l01712" name="l01712"></a><span class="lineno"> 1712</span>        <span class="keywordtype">double</span> V0CC[3]            = {0.0};</div>
<div class="line"><a id="l01713" name="l01713"></a><span class="lineno"> 1713</span>        <span class="keywordtype">double</span> a[3]               = {0.0};</div>
<div class="line"><a id="l01714" name="l01714"></a><span class="lineno"> 1714</span>        <span class="keywordtype">double</span> normal_outwards[3] = {0.0};</div>
<div class="line"><a id="l01715" name="l01715"></a><span class="lineno"> 1715</span>        <span class="keywordtype">double</span> Radius_SQ          = 0.0;</div>
<div class="line"><a id="l01716" name="l01716"></a><span class="lineno"> 1716</span>        <span class="keywordtype">double</span> distance_V0V1      = 0.0;</div>
<div class="line"><a id="l01717" name="l01717"></a><span class="lineno"> 1717</span>        <span class="keywordtype">double</span> dist_CoM           = 0.0;</div>
<div class="line"><a id="l01718" name="l01718"></a><span class="lineno"> 1718</span>        AreaSegC                  = 0.0;</div>
<div class="line"><a id="l01719" name="l01719"></a><span class="lineno"> 1719</span>        flag = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01720" name="l01720"></a><span class="lineno"> 1720</span> </div>
<div class="line"><a id="l01721" name="l01721"></a><span class="lineno"> 1721</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = 0; index&lt;3; index++) {</div>
<div class="line"><a id="l01722" name="l01722"></a><span class="lineno"> 1722</span> </div>
<div class="line"><a id="l01723" name="l01723"></a><span class="lineno"> 1723</span>            V0V1[index]     = V1[index] - V0[index];</div>
<div class="line"><a id="l01724" name="l01724"></a><span class="lineno"> 1724</span>            V0CC[index]     = Centre[index] - V0[index];</div>
<div class="line"><a id="l01725" name="l01725"></a><span class="lineno"> 1725</span>        }</div>
<div class="line"><a id="l01726" name="l01726"></a><span class="lineno"> 1726</span> </div>
<div class="line"><a id="l01727" name="l01727"></a><span class="lineno"> 1727</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">GeometryFunctions::CrossProduct</a>(V0V1,Normal,normal_outwards);</div>
<div class="line"><a id="l01728" name="l01728"></a><span class="lineno"> 1728</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">GeometryFunctions::normalize</a>(V0V1,distance_V0V1);</div>
<div class="line"><a id="l01729" name="l01729"></a><span class="lineno"> 1729</span> </div>
<div class="line"><a id="l01730" name="l01730"></a><span class="lineno"> 1730</span>        <span class="keywordtype">double</span> distV0 =  <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae3bbd7194a2ffdee9412e5b3ad716e26">GeometryFunctions::DotProduct</a>(V0CC,V0V1);</div>
<div class="line"><a id="l01731" name="l01731"></a><span class="lineno"> 1731</span> </div>
<div class="line"><a id="l01732" name="l01732"></a><span class="lineno"> 1732</span>        <span class="keywordflow">if</span> ((distV0 &gt; 0.0) &amp;&amp; (distV0 &lt; distance_V0V1)) {</div>
<div class="line"><a id="l01733" name="l01733"></a><span class="lineno"> 1733</span> </div>
<div class="line"><a id="l01734" name="l01734"></a><span class="lineno"> 1734</span>            <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">GeometryFunctions::normalize</a>(normal_outwards);</div>
<div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span>            <span class="keywordtype">double</span> dist_normal   = <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae3bbd7194a2ffdee9412e5b3ad716e26">GeometryFunctions::DotProduct</a>(normal_outwards,V0CC);</div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span>            <span class="keywordtype">double</span> delta_circle  = Radius + dist_normal; <span class="comment">//distance can be positive or negative, depending on the side where the circle is</span></div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span> </div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span>            <span class="keywordflow">if</span> ((delta_circle &gt; tol_Radius) &amp;&amp; ( delta_circle - 2.0*Radius &lt; -tol_Radius)) {<span class="comment">//check for intersection</span></div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span> </div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span>                Radius_SQ = Radius*Radius;</div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span>                <span class="keywordtype">double</span> semi_dist = sqrt(Radius_SQ - dist_normal*dist_normal);</div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span>                flag = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span> </div>
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"> 1744</span>                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = 0;index&lt;3;index++) {</div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"> 1745</span> </div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span>                    a[index] = V0[index] + (distV0 - semi_dist)*V0V1[index] - Centre[index]; <span class="comment">//Vector from Center to first intersection point</span></div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"> 1747</span>                }</div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span> </div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"> 1749</span>                <span class="keywordtype">double</span> cos_alpha = <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae3bbd7194a2ffdee9412e5b3ad716e26">GeometryFunctions::DotProduct</a>(a,normal_outwards)/(<a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a44c5245fc1c0b5505bb15b31a705d8ff">GeometryFunctions::module</a>(a)*<a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a44c5245fc1c0b5505bb15b31a705d8ff">GeometryFunctions::module</a>(normal_outwards));</div>
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"> 1750</span>                <span class="keywordtype">double</span> alpha = acos(cos_alpha);</div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span>                <span class="keywordtype">double</span> sin_alpha = std::sin(alpha);</div>
<div class="line"><a id="l01752" name="l01752"></a><span class="lineno"> 1752</span> </div>
<div class="line"><a id="l01753" name="l01753"></a><span class="lineno"> 1753</span>                AreaSegC = Radius_SQ*(alpha-sin_alpha*cos_alpha);</div>
<div class="line"><a id="l01754" name="l01754"></a><span class="lineno"> 1754</span> </div>
<div class="line"><a id="l01755" name="l01755"></a><span class="lineno"> 1755</span>                <span class="keywordflow">if</span> (fabs(sin_alpha) &lt; tol_Radius) {dist_CoM=0.0;}</div>
<div class="line"><a id="l01756" name="l01756"></a><span class="lineno"> 1756</span> </div>
<div class="line"><a id="l01757" name="l01757"></a><span class="lineno"> 1757</span>                <span class="keywordflow">else</span> {dist_CoM = 0.6666666666666 * (Radius*sin_alpha*sin_alpha*sin_alpha/(alpha-sin_alpha*cos_alpha));}</div>
<div class="line"><a id="l01758" name="l01758"></a><span class="lineno"> 1758</span> </div>
<div class="line"><a id="l01759" name="l01759"></a><span class="lineno"> 1759</span>                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = 0; index&lt;3; index++) {</div>
<div class="line"><a id="l01760" name="l01760"></a><span class="lineno"> 1760</span>                    CoMSegC[index] = Centre[index] + dist_CoM*normal_outwards[index];</div>
<div class="line"><a id="l01761" name="l01761"></a><span class="lineno"> 1761</span>                }</div>
<div class="line"><a id="l01762" name="l01762"></a><span class="lineno"> 1762</span>            } <span class="comment">//if normal dist is okay</span></div>
<div class="line"><a id="l01763" name="l01763"></a><span class="lineno"> 1763</span> </div>
<div class="line"><a id="l01764" name="l01764"></a><span class="lineno"> 1764</span>        } <span class="comment">// if longitudinal dist is okay</span></div>
<div class="line"><a id="l01765" name="l01765"></a><span class="lineno"> 1765</span> </div>
<div class="line"><a id="l01766" name="l01766"></a><span class="lineno"> 1766</span>    }<span class="comment">//AreaAndCentroidCircularSegment</span></div>
<div class="line"><a id="l01767" name="l01767"></a><span class="lineno"> 1767</span> </div>
<div class="line"><a id="l01768" name="l01768"></a><span class="lineno"><a class="line" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a7f85d9ecd71565c22946888face1bfee"> 1768</a></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a7f85d9ecd71565c22946888face1bfee">AreaAndCentroidTriangle</a>(<span class="keywordtype">double</span> Coord1[3], <span class="keywordtype">double</span> Coord2[3], <span class="keywordtype">double</span> Coord3[3], <span class="keywordtype">double</span>&amp; area, <span class="keywordtype">double</span> CoMTri[3]) {</div>
<div class="line"><a id="l01769" name="l01769"></a><span class="lineno"> 1769</span> </div>
<div class="line"><a id="l01770" name="l01770"></a><span class="lineno"> 1770</span>        <a class="code hl_function" href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afa1405629ee9c79223f163b606151df1">TriAngleArea</a>(Coord1,Coord2,Coord3,area);</div>
<div class="line"><a id="l01771" name="l01771"></a><span class="lineno"> 1771</span> </div>
<div class="line"><a id="l01772" name="l01772"></a><span class="lineno"> 1772</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index =0; index&lt;3; index++) {</div>
<div class="line"><a id="l01773" name="l01773"></a><span class="lineno"> 1773</span> </div>
<div class="line"><a id="l01774" name="l01774"></a><span class="lineno"> 1774</span>            CoMTri[index] = 0.33333333333333 * (Coord1[index]+Coord2[index]+Coord3[index]);</div>
<div class="line"><a id="l01775" name="l01775"></a><span class="lineno"> 1775</span>            }</div>
<div class="line"><a id="l01776" name="l01776"></a><span class="lineno"> 1776</span> </div>
<div class="line"><a id="l01777" name="l01777"></a><span class="lineno"> 1777</span>        } <span class="comment">//AreaAndCentroidTriangle</span></div>
<div class="line"><a id="l01778" name="l01778"></a><span class="lineno"> 1778</span> </div>
<div class="line"><a id="l01779" name="l01779"></a><span class="lineno"> 1779</span>    } <span class="comment">//namespace GeometryFunctions</span></div>
<div class="line"><a id="l01780" name="l01780"></a><span class="lineno"> 1780</span> </div>
<div class="line"><a id="l01781" name="l01781"></a><span class="lineno"> 1781</span>} <span class="comment">//namespace Kratos</span></div>
<div class="line"><a id="l01782" name="l01782"></a><span class="lineno"> 1782</span> </div>
<div class="line"><a id="l01783" name="l01783"></a><span class="lineno"> 1783</span><span class="preprocessor">#endif  </span><span class="comment">/* _GEOMETRYFUNCTIONS_H */</span><span class="preprocessor"></span></div>
<div class="ttc" id="a_d_e_m__application__variables_8h_html"><div class="ttname"><a href="../../d9/d06/_d_e_m__application__variables_8h.html">DEM_application_variables.h</a></div></div>
<div class="ttc" id="a_d_e_m__application__variables_8h_html_a33d81a3e79bb06d94c0d6b7ceb3b4c05"><div class="ttname"><a href="../../d9/d06/_d_e_m__application__variables_8h.html#a33d81a3e79bb06d94c0d6b7ceb3b4c05">DEM_MODULUS_3</a></div><div class="ttdeci">#define DEM_MODULUS_3(a)</div><div class="ttdef"><b>Definition:</b> DEM_application_variables.h:29</div></div>
<div class="ttc" id="a_d_e_m__application__variables_8h_html_a5961243e3c6063179b397f430f5bad24"><div class="ttname"><a href="../../d9/d06/_d_e_m__application__variables_8h.html#a5961243e3c6063179b397f430f5bad24">DEM_MULTIPLY_BY_SCALAR_3</a></div><div class="ttdeci">#define DEM_MULTIPLY_BY_SCALAR_3(a, b)</div><div class="ttdef"><b>Definition:</b> DEM_application_variables.h:28</div></div>
<div class="ttc" id="a_d_e_m__application__variables_8h_html_a963d27657c723d4127e779af7cd0d952"><div class="ttname"><a href="../../d9/d06/_d_e_m__application__variables_8h.html#a963d27657c723d4127e779af7cd0d952">DEM_INNER_PRODUCT_3</a></div><div class="ttdeci">#define DEM_INNER_PRODUCT_3(a, b)</div><div class="ttdef"><b>Definition:</b> DEM_application_variables.h:31</div></div>
<div class="ttc" id="a_d_e_m__application__variables_8h_html_a9fe1bbee9061a6d9e432147bd6c78d6b"><div class="ttname"><a href="../../d9/d06/_d_e_m__application__variables_8h.html#a9fe1bbee9061a6d9e432147bd6c78d6b">DEM_SET_TO_CROSS_OF_FIRST_TWO_3</a></div><div class="ttdeci">#define DEM_SET_TO_CROSS_OF_FIRST_TWO_3(a, b, c)</div><div class="ttdef"><b>Definition:</b> DEM_application_variables.h:32</div></div>
<div class="ttc" id="a_d_e_m__application__variables_8h_html_aa821daf08950421b2a257e807401346a"><div class="ttname"><a href="../../d9/d06/_d_e_m__application__variables_8h.html#aa821daf08950421b2a257e807401346a">DEM_COPY_SECOND_TO_FIRST_3</a></div><div class="ttdeci">#define DEM_COPY_SECOND_TO_FIRST_3(a, b)</div><div class="ttdef"><b>Definition:</b> DEM_application_variables.h:23</div></div>
<div class="ttc" id="aclass_kratos_1_1_geometry_html"><div class="ttname"><a href="../../dc/dea/class_kratos_1_1_geometry.html">Kratos::Geometry</a></div><div class="ttdoc">Geometry base class.</div><div class="ttdef"><b>Definition:</b> geometry.h:71</div></div>
<div class="ttc" id="aclass_kratos_1_1_geometry_html_a2477b702b7e4972903ca29e31b6ded56"><div class="ttname"><a href="../../dc/dea/class_kratos_1_1_geometry.html#a2477b702b7e4972903ca29e31b6ded56">Kratos::Geometry::size</a></div><div class="ttdeci">SizeType size() const</div><div class="ttdef"><b>Definition:</b> geometry.h:518</div></div>
<div class="ttc" id="aclass_kratos_1_1_internals_1_1_matrix_html"><div class="ttname"><a href="../../d9/dbb/class_kratos_1_1_internals_1_1_matrix.html">Kratos::Internals::Matrix&lt; double, AMatrix::dynamic, 1 &gt;</a></div></div>
<div class="ttc" id="aclass_kratos_1_1_math_utils_html"><div class="ttname"><a href="../../d2/df1/class_kratos_1_1_math_utils.html">Kratos::MathUtils</a></div><div class="ttdoc">Various mathematical utilitiy functions.</div><div class="ttdef"><b>Definition:</b> math_utils.h:61</div></div>
<div class="ttc" id="aclass_kratos_1_1_math_utils_html_a7b2eab287f67cf69dcc536fe4f533db5"><div class="ttname"><a href="../../d2/df1/class_kratos_1_1_math_utils.html#a7b2eab287f67cf69dcc536fe4f533db5">Kratos::MathUtils::Norm3</a></div><div class="ttdeci">static TDataType Norm3(const TVectorType &amp;a)</div><div class="ttdoc">Calculates the norm of vector &quot;a&quot; which is assumed to be of size 3.</div><div class="ttdef"><b>Definition:</b> math_utils.h:769</div></div>
<div class="ttc" id="aclass_kratos_1_1_quaternion_html"><div class="ttname"><a href="../../da/de5/class_kratos_1_1_quaternion.html">Kratos::Quaternion</a></div><div class="ttdoc">Quaternion A simple class that implements the main features of quaternion algebra.</div><div class="ttdef"><b>Definition:</b> quaternion.h:28</div></div>
<div class="ttc" id="aclass_kratos_1_1_quaternion_html_a05c4d8f18e012cb9f7a3eaed6808317e"><div class="ttname"><a href="../../da/de5/class_kratos_1_1_quaternion.html#a05c4d8f18e012cb9f7a3eaed6808317e">Kratos::Quaternion::Identity</a></div><div class="ttdeci">static Quaternion Identity()</div><div class="ttdef"><b>Definition:</b> quaternion.h:398</div></div>
<div class="ttc" id="aclass_kratos_1_1_quaternion_html_a1d560a6c082202c9347c7ab8697001be"><div class="ttname"><a href="../../da/de5/class_kratos_1_1_quaternion.html#a1d560a6c082202c9347c7ab8697001be">Kratos::Quaternion::normalize</a></div><div class="ttdeci">void normalize()</div><div class="ttdef"><b>Definition:</b> quaternion.h:194</div></div>
<div class="ttc" id="aclass_kratos_1_1_quaternion_html_a242b17e9f106df2c77b6a3fae3a6f549"><div class="ttname"><a href="../../da/de5/class_kratos_1_1_quaternion.html#a242b17e9f106df2c77b6a3fae3a6f549">Kratos::Quaternion::ToRotationMatrix</a></div><div class="ttdeci">void ToRotationMatrix(TMatrix3x3 &amp;R) const</div><div class="ttdef"><b>Definition:</b> quaternion.h:228</div></div>
<div class="ttc" id="aclass_kratos_1_1_quaternion_html_a56c77438bf6d1a26a189420d100ac16d"><div class="ttname"><a href="../../da/de5/class_kratos_1_1_quaternion.html#a56c77438bf6d1a26a189420d100ac16d">Kratos::Quaternion::ToEulerAngles</a></div><div class="ttdeci">void ToEulerAngles(array_1d&lt; double, 3 &gt; &amp;EA) const</div><div class="ttdef"><b>Definition:</b> quaternion.h:251</div></div>
<div class="ttc" id="aclass_kratos_1_1_quaternion_html_a63912bf4600aff6a709d7460699a7b3c"><div class="ttname"><a href="../../da/de5/class_kratos_1_1_quaternion.html#a63912bf4600aff6a709d7460699a7b3c">Kratos::Quaternion::RotateVector3</a></div><div class="ttdeci">void RotateVector3(const TVector3_A &amp;a, TVector3_B &amp;b) const</div><div class="ttdef"><b>Definition:</b> quaternion.h:340</div></div>
<div class="ttc" id="aclass_kratos_1_1array__1d_html"><div class="ttname"><a href="../../d4/ddc/class_kratos_1_1array__1d.html">Kratos::array_1d</a></div><div class="ttdoc">Short class definition.</div><div class="ttdef"><b>Definition:</b> array_1d.h:70</div></div>
<div class="ttc" id="adefine_8h_html_a6135b00508a42f0e8f91d1369644cbc1"><div class="ttname"><a href="../../df/d67/define_8h.html#a6135b00508a42f0e8f91d1369644cbc1">KRATOS_WATCH</a></div><div class="ttdeci">#define KRATOS_WATCH(variable)</div><div class="ttdef"><b>Definition:</b> define.h:804</div></div>
<div class="ttc" id="ammio_8h_html_a3f620e88ba511ca5d32c93b84802ff6e"><div class="ttname"><a href="../../df/d42/mmio_8h.html#a3f620e88ba511ca5d32c93b84802ff6e">N</a></div><div class="ttdeci">int int * N</div><div class="ttdef"><b>Definition:</b> mmio.h:23</div></div>
<div class="ttc" id="amodel__part_8h_html"><div class="ttname"><a href="../../dd/dfe/model__part_8h.html">model_part.h</a></div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a0b1a8799cac8c1419ffa55034c70dc18"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a0b1a8799cac8c1419ffa55034c70dc18">Kratos::GeometryFunctions::WeightsCalculation</a></div><div class="ttdeci">static void WeightsCalculation(std::vector&lt; double &gt; Area, std::vector&lt; double &gt; &amp;Weight)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:990</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a1645d874bbf5348c6e1352178aff0b43"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a1645d874bbf5348c6e1352178aff0b43">Kratos::GeometryFunctions::QuaternionVectorGlobal2Local</a></div><div class="ttdeci">static void QuaternionVectorGlobal2Local(const Quaternion&lt; double &gt; &amp;Q, const array_1d&lt; double, 3 &gt; &amp;GlobalVector, array_1d&lt; double, 3 &gt; &amp;LocalVector)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:764</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a18c3b7ac56a9b8e96b126027cff9f8e8"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a18c3b7ac56a9b8e96b126027cff9f8e8">Kratos::GeometryFunctions::FastFacetCheck</a></div><div class="ttdeci">static bool FastFacetCheck(const std::vector&lt; array_1d&lt; double, 3 &gt; &gt; &amp;Coord, const array_1d&lt; double, 3 &gt; &amp;Particle_Coord, double rad, double &amp;DistPToB, unsigned int &amp;current_edge_index)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:1016</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a1d09f932b41cbb89029b69eba942a631"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a1d09f932b41cbb89029b69eba942a631">Kratos::GeometryFunctions::FastVertexCheck</a></div><div class="ttdeci">static bool FastVertexCheck(const array_1d&lt; double, 3 &gt; &amp;Coord, const array_1d&lt; double, 3 &gt; &amp;Particle_Coord, double Radius)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:1322</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a1dc452646721c6a9d6cd91f3279a56ae"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a1dc452646721c6a9d6cd91f3279a56ae">Kratos::GeometryFunctions::RotaMatrixTensorLocal2Global</a></div><div class="ttdeci">static void RotaMatrixTensorLocal2Global(const double R[3][3], const double LocalTensor[3][3], double GlobalTensor[3][3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:274</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a1e040cca465a7040da307e031155e3c3"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a1e040cca465a7040da307e031155e3c3">Kratos::GeometryFunctions::VectorLocal2Global</a></div><div class="ttdeci">static void VectorLocal2Global(const double LocalCoordSystem[3][3], const double LocalVector[3], double GlobalVector[3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:178</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a2658e0a68e9d374ec08c496099bda9f9"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a2658e0a68e9d374ec08c496099bda9f9">Kratos::GeometryFunctions::RotateRightHandedBasisAroundAxis</a></div><div class="ttdeci">static void RotateRightHandedBasisAroundAxis(const array_1d&lt; double, 3 &gt; &amp;e1, const array_1d&lt; double, 3 &gt; &amp;e2, const array_1d&lt; double, 3 &gt; &amp;axis, const double ang, array_1d&lt; double, 3 &gt; &amp;new_axes1, array_1d&lt; double, 3 &gt; &amp;new_axes2, array_1d&lt; double, 3 &gt; &amp;new_axes3)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:367</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a283ea24b4791dfdfa288f28dbce94bd8"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a283ea24b4791dfdfa288f28dbce94bd8">Kratos::GeometryFunctions::GetGiDEulerAngles</a></div><div class="ttdeci">static void GetGiDEulerAngles(const BoundedMatrix&lt; double, 3, 3 &gt; &amp;rotation_matrix, array_1d&lt; double, 3 &gt; &amp;EulerAngles)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:1562</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a2966caf76d2080f6bf0b3aca3e9a40c3"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a2966caf76d2080f6bf0b3aca3e9a40c3">Kratos::GeometryFunctions::QuaternionVectorLocal2Global</a></div><div class="ttdeci">static void QuaternionVectorLocal2Global(const Quaternion&lt; double &gt; &amp;Q, const array_1d&lt; double, 3 &gt; &amp;LocalVector, array_1d&lt; double, 3 &gt; &amp;GlobalVector)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:759</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a299b87fdd0db45abd51d1b7e06e16d04"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a299b87fdd0db45abd51d1b7e06e16d04">Kratos::GeometryFunctions::EdgeCheck</a></div><div class="ttdeci">static bool EdgeCheck(const array_1d&lt; double, 3 &gt; &amp;Coord1, const array_1d&lt; double, 3 &gt; &amp;Coord2, const array_1d&lt; double, 3 &gt; &amp;Particle_Coord, double Radius, double LocalCoordSystem[3][3], double &amp;DistParticleToEdge, double &amp;eta)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:1251</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a2f195913327f033e2118653b380b157a"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a2f195913327f033e2118653b380b157a">Kratos::GeometryFunctions::ConstructInvLocalTensor</a></div><div class="ttdeci">static void ConstructInvLocalTensor(const double moment_of_inertia, double LocalTensorInv[3][3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:293</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a31de8c72c4269a6d41a957e02f5abfa9"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a31de8c72c4269a6d41a957e02f5abfa9">Kratos::GeometryFunctions::normalize</a></div><div class="ttdeci">static void normalize(double Vector[3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:87</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a3328e346ff8765552b131f7447f6e6f2"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a3328e346ff8765552b131f7447f6e6f2">Kratos::GeometryFunctions::RotateAVectorAGivenAngleAroundAUnitaryVector</a></div><div class="ttdeci">static void RotateAVectorAGivenAngleAroundAUnitaryVector(const array_1d&lt; double, 3 &gt; &amp;old_vec, const array_1d&lt; double, 3 &gt; &amp;axis, const double ang, array_1d&lt; double, 3 &gt; &amp;new_vec)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:23</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a39f63df8ff12dd40eb983fc7562d7015"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a39f63df8ff12dd40eb983fc7562d7015">Kratos::GeometryFunctions::ComputeContactLocalCoordSystem</a></div><div class="ttdeci">static void ComputeContactLocalCoordSystem(array_1d&lt; double, 3 &gt; NormalDirection, const double &amp;distance, double LocalCoordSystem[3][3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:490</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a3dbb20067718c4e219ee51f0024739f2"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a3dbb20067718c4e219ee51f0024739f2">Kratos::GeometryFunctions::Compute3DimElementFaceLocalSystem</a></div><div class="ttdeci">static void Compute3DimElementFaceLocalSystem(const array_1d&lt; double, 3 &gt; &amp;FaceCoord1, const array_1d&lt; double, 3 &gt; &amp;FaceCoord2, const array_1d&lt; double, 3 &gt; &amp;FaceCoord3, double ParticleCoord[3], double LocalCoordSystem[3][3], double &amp;normal_flag)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:622</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a44c5245fc1c0b5505bb15b31a705d8ff"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a44c5245fc1c0b5505bb15b31a705d8ff">Kratos::GeometryFunctions::module</a></div><div class="ttdeci">static void module(const array_1d&lt; double, 3 &gt; &amp;Vector, double &amp;distance)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:127</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a4e986e29b94d7b5516a8031cf6efdaa8"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a4e986e29b94d7b5516a8031cf6efdaa8">Kratos::GeometryFunctions::EulerAnglesFromRotationAngle</a></div><div class="ttdeci">static void EulerAnglesFromRotationAngle(array_1d&lt; double, 3 &gt; &amp;EulerAngles, const array_1d&lt; double, 3 &gt; &amp;RotatedAngle)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:870</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a53a533bbfbaf2c440fcdcf78bb69c8af"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a53a533bbfbaf2c440fcdcf78bb69c8af">Kratos::GeometryFunctions::FastEdgeVertexCheck</a></div><div class="ttdeci">static bool FastEdgeVertexCheck(const array_1d&lt; double, 3 &gt; &amp;Coord1, const array_1d&lt; double, 3 &gt; &amp;Coord2, const array_1d&lt; double, 3 &gt; &amp;Particle_Coord, double Radius)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:1178</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a5c2e6fe59d0e42509db6e46b320548da"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a5c2e6fe59d0e42509db6e46b320548da">Kratos::GeometryFunctions::GetEulerAngles</a></div><div class="ttdeci">static void GetEulerAngles(const double rotation_matrix[3][3], array_1d&lt; double, 3 &gt; &amp;EulerAngles)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:1534</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a5d815ee1bd1baa359992407bb97b8fa7"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a5d815ee1bd1baa359992407bb97b8fa7">Kratos::GeometryFunctions::InsideOutside</a></div><div class="ttdeci">static bool InsideOutside(const array_1d&lt; double, 3 &gt; &amp;Coord1, const array_1d&lt; double, 3 &gt; &amp;Coord2, const array_1d&lt; double, 3 &gt; &amp;JudgeCoord, const array_1d&lt; double, 3 &gt; &amp;normal_element, double &amp;area)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:939</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a63186ad62a225cd7bf47a40a09bf4e5f"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a63186ad62a225cd7bf47a40a09bf4e5f">Kratos::GeometryFunctions::QuadAngleWeight</a></div><div class="ttdeci">static void QuadAngleWeight(double Coord1[3], double Coord2[3], double Coord3[3], double Coord4[3], double JudgeCoord[3], double Weight[4])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:1622</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a6a0b41cecc5d952cbfe4b0625b0f2d62"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a6a0b41cecc5d952cbfe4b0625b0f2d62">Kratos::GeometryFunctions::TensorLocal2Global</a></div><div class="ttdeci">static void TensorLocal2Global(const double LocalCoordSystem[3][3], const double LocalTensor[3][3], double GlobalTensor[3][3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:257</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a6dd6d8ebcb12bb31de7d33ef2bdb1e59"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a6dd6d8ebcb12bb31de7d33ef2bdb1e59">Kratos::GeometryFunctions::AreaAndCentroidCircularSegment</a></div><div class="ttdeci">static void AreaAndCentroidCircularSegment(double Centre[3], double Radius, double tol_Radius, double V0[3], double V1[3], double Normal[3], double &amp;AreaSegC, double CoMSegC[3], bool &amp;flag)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:1709</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a746a9464281ea36e250dd638fe0bb1fb"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a746a9464281ea36e250dd638fe0bb1fb">Kratos::GeometryFunctions::ProductMatrix3X3Vector3X1</a></div><div class="ttdeci">static void ProductMatrix3X3Vector3X1(const double Matrix[3][3], const array_1d&lt; double, 3 &gt; &amp;Vector1, array_1d&lt; double, 3 &gt; &amp;Vector2)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:230</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a796e36ac46bfa5ddff527edfe68a98ef"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a796e36ac46bfa5ddff527edfe68a98ef">Kratos::GeometryFunctions::TranslateGridOfNodes</a></div><div class="ttdeci">static void TranslateGridOfNodes(const double time, const double velocity_start_time, const double velocity_stop_time, array_1d&lt; double, 3 &gt; &amp;center_position, const array_1d&lt; double, 3 &gt; &amp;initial_center, array_1d&lt; double, 3 &gt; &amp;previous_displ, array_1d&lt; double, 3 &gt; &amp;linear_velocity_changed, const double linear_period, const double dt, const array_1d&lt; double, 3 &gt; &amp;linear_velocity)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:33</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a7f85d9ecd71565c22946888face1bfee"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a7f85d9ecd71565c22946888face1bfee">Kratos::GeometryFunctions::AreaAndCentroidTriangle</a></div><div class="ttdeci">static void AreaAndCentroidTriangle(double Coord1[3], double Coord2[3], double Coord3[3], double &amp;area, double CoMTri[3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:1768</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a819e51c089a0d603f13c6ce87e7cbed5"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a819e51c089a0d603f13c6ce87e7cbed5">Kratos::GeometryFunctions::max</a></div><div class="ttdeci">static double max(double a, double b)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:79</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a845d535279dafda7a88ef0ed1a23249b"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a845d535279dafda7a88ef0ed1a23249b">Kratos::GeometryFunctions::AlternativeAreaCircularSegment</a></div><div class="ttdeci">static void AlternativeAreaCircularSegment(double Radius, double tol_Radius, double V0V1[3], double V0CC[3], double Normal[3], double &amp;AreaSC, bool &amp;flag)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:1688</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a84c07e46836a58fe4e940cf567ca597a"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a84c07e46836a58fe4e940cf567ca597a">Kratos::GeometryFunctions::CoordProjectionOnPlane</a></div><div class="ttdeci">static void CoordProjectionOnPlane(double CoordOut[3], double CoordIn[3], double LocalCoordSystem[3][3], double IntersectionCoord[3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:588</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a86caa4144e4384c0c7b1c292505a58c9"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a86caa4144e4384c0c7b1c292505a58c9">Kratos::GeometryFunctions::VertexCheck</a></div><div class="ttdeci">static bool VertexCheck(const array_1d&lt; double, 3 &gt; &amp;Coord, const array_1d&lt; double, 3 &gt; &amp;Particle_Coord, double Radius, double LocalCoordSystem[3][3], double &amp;DistParticleToVertex)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:1303</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a8b82ff18a2325582290edbf260630125"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a8b82ff18a2325582290edbf260630125">Kratos::GeometryFunctions::OrientationFromRotationAngle</a></div><div class="ttdeci">static void OrientationFromRotationAngle(Quaternion&lt; double &gt; &amp;DeltaOrientation, const array_1d&lt; double, 3 &gt; &amp;DeltaRotation)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:894</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a8bc9419a30174c9727e9024f95bb669e"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a8bc9419a30174c9727e9024f95bb669e">Kratos::GeometryFunctions::FacetCheck</a></div><div class="ttdeci">static bool FacetCheck(const GeometryType &amp;Coord, const array_1d&lt; double, 3 &gt; &amp;Particle_Coord, double rad, double LocalCoordSystem[3][3], double &amp;DistPToB, std::vector&lt; double &gt; &amp;Weight, unsigned int &amp;current_edge_index, bool &amp;inside)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:1081</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a92cd4c64cb64ef8781a9adfa78f09ae9"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a92cd4c64cb64ef8781a9adfa78f09ae9">Kratos::GeometryFunctions::RotatePointAboutArbitraryLine</a></div><div class="ttdeci">static void RotatePointAboutArbitraryLine(array_1d&lt; double, 3 &gt; &amp;TargetPoint, const array_1d&lt; double, 3 &gt; &amp;CentrePoint, const array_1d&lt; double, 3 &gt; &amp;LineVector, const double RotationAngle)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:735</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_a9f9a6dc92324d6707aee78da6b05f84d"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#a9f9a6dc92324d6707aee78da6b05f84d">Kratos::GeometryFunctions::GetRotationMatrix</a></div><div class="ttdeci">static void GetRotationMatrix(const array_1d&lt; double, 3 &gt; &amp;EulerAngles, double rotation_matrix[3][3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:1512</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_aa5b3afa9f1931218e026b55f1cb58ec6"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aa5b3afa9f1931218e026b55f1cb58ec6">Kratos::GeometryFunctions::DistanceOfTwoPointSquared</a></div><div class="ttdeci">static double DistanceOfTwoPointSquared(const array_1d&lt; double, 3 &gt; &amp;coord1, const array_1d&lt; double, 3 &gt; &amp;coord2)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:557</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_aa5b886ee8ed2deebad2c51bb086023bd"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aa5b886ee8ed2deebad2c51bb086023bd">Kratos::GeometryFunctions::UpdateKinematicVariablesOfAGridOfNodes</a></div><div class="ttdeci">static void UpdateKinematicVariablesOfAGridOfNodes(double mod_angular_velocity, const array_1d&lt; double, 3 &gt; &amp;linear_velocity, const array_1d&lt; double, 3 &gt; &amp;initial_center, array_1d&lt; double, 3 &gt; &amp;new_axes1, array_1d&lt; double, 3 &gt; &amp;new_axes2, array_1d&lt; double, 3 &gt; &amp;new_axes3, array_1d&lt; double, 3 &gt; &amp;angular_velocity_changed, array_1d&lt; double, 3 &gt; &amp;linear_velocity_changed, array_1d&lt; double, 3 &gt; &amp;center_position, const bool fixed_mesh, const double dt, ModelPart::NodesContainerType &amp;pNodes)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:448</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_aaa04a5353a4697694bd0bbaa3a0a6e67"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aaa04a5353a4697694bd0bbaa3a0a6e67">Kratos::GeometryFunctions::ConstructLocalTensor</a></div><div class="ttdeci">static void ConstructLocalTensor(const double moment_of_inertia, double LocalTensor[3][3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:286</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_aad62f5cfe6d8bcc83ec7b0545ed03f87"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aad62f5cfe6d8bcc83ec7b0545ed03f87">Kratos::GeometryFunctions::QuaternionToGiDEulerAngles</a></div><div class="ttdeci">void QuaternionToGiDEulerAngles(const Quaternion&lt; double &gt; &amp;quaternion, array_1d&lt; double, 3 &gt; &amp;EulerAngles)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:1581</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_aad87cabb87e339cb0dcef29fd6064907"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aad87cabb87e339cb0dcef29fd6064907">Kratos::GeometryFunctions::DistanceOfTwoPoint</a></div><div class="ttdeci">static double DistanceOfTwoPoint(const double coord1[3], const double coord2[3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:539</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_ab4b8cf8d84059172cdaceb96a51b0f90"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab4b8cf8d84059172cdaceb96a51b0f90">Kratos::GeometryFunctions::QuaternionTensorLocal2Global</a></div><div class="ttdeci">static void QuaternionTensorLocal2Global(const Quaternion&lt; double &gt; &amp;Q, const double LocalTensor[3][3], double GlobalTensor[3][3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:770</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_ab5272b90bc716e638c5caed74227dc34"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab5272b90bc716e638c5caed74227dc34">Kratos::GeometryFunctions::CrossProduct</a></div><div class="ttdeci">static void CrossProduct(const double u[3], const double v[3], double ReturnVector[3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:325</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_ab6a0ffd732c17095cec3cc6826bfcbe7"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab6a0ffd732c17095cec3cc6826bfcbe7">Kratos::GeometryFunctions::DistancePointToPlane</a></div><div class="ttdeci">static double DistancePointToPlane(const array_1d&lt; double, 3 &gt; &amp;CoordInPlane, double PlaneUnitNormalVector[3], double TestCoord[3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:574</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_ab96a3d6816e74ff6294db25421a7ddb8"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ab96a3d6816e74ff6294db25421a7ddb8">Kratos::GeometryFunctions::sign</a></div><div class="ttdeci">static int sign(const double a)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:61</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_ac071c0e9b1a2de8fbb26df2ef5eee343"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ac071c0e9b1a2de8fbb26df2ef5eee343">Kratos::GeometryFunctions::GeometryType</a></div><div class="ttdeci">Geometry&lt; Node&lt; 3 &gt; &gt; GeometryType</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:21</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_ac1deb53a9a7d842899da0a23c8efdf65"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ac1deb53a9a7d842899da0a23c8efdf65">Kratos::GeometryFunctions::TensorGlobal2Local</a></div><div class="ttdeci">static void TensorGlobal2Local(const double LocalCoordSystem[3][3], const double GlobalTensor[3][3], double LocalTensor[3][3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:240</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_ac7f99de1af66b26805e3b597d98623ab"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ac7f99de1af66b26805e3b597d98623ab">Kratos::GeometryFunctions::ProductMatrices3X3</a></div><div class="ttdeci">static void ProductMatrices3X3(const double Matrix1[3][3], const double Matrix2[3][3], double Matrix3[3][3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:218</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_acc99621a8dbda7d46b34669511883258"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#acc99621a8dbda7d46b34669511883258">Kratos::GeometryFunctions::RotateGridOfNodes</a></div><div class="ttdeci">static void RotateGridOfNodes(const double time, const double angular_velocity_start_time, const double angular_velocity_stop_time, array_1d&lt; double, 3 &gt; &amp;angular_velocity_changed, const double angular_period, const double mod_angular_velocity, const array_1d&lt; double, 3 &gt; &amp;angular_velocity, array_1d&lt; double, 3 &gt; &amp;new_axes1, array_1d&lt; double, 3 &gt; &amp;new_axes2, array_1d&lt; double, 3 &gt; &amp;new_axes3)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:378</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_ae1bc980b367fa7f5536b4938cee0f434"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae1bc980b367fa7f5536b4938cee0f434">Kratos::GeometryFunctions::AreaAndCentroidCircularSector</a></div><div class="ttdeci">static void AreaAndCentroidCircularSector(double C[3], double Radius, double P1[3], double P2[3], double Normal[3], double &amp;Area, double CoMSC[3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:1646</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_ae1d4ef45066314fc382b7f7886a66388"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae1d4ef45066314fc382b7f7886a66388">Kratos::GeometryFunctions::TriAngleWeight</a></div><div class="ttdeci">static void TriAngleWeight(double Coord1[3], double Coord2[3], double Coord3[3], double JudgeCoord[3], double Weight[3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:1606</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_ae3bbd7194a2ffdee9412e5b3ad716e26"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae3bbd7194a2ffdee9412e5b3ad716e26">Kratos::GeometryFunctions::DotProduct</a></div><div class="ttdeci">static double DotProduct(double Vector1[3], double Vector2[3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:315</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_ae93507f29577a1b3937dbd77936731ac"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#ae93507f29577a1b3937dbd77936731ac">Kratos::GeometryFunctions::CoordProjectionOnPlaneNew</a></div><div class="ttdeci">static void CoordProjectionOnPlaneNew(double CoordOut[3], const array_1d&lt; double, 3 &gt; &amp;CoordIn, double LocalCoordSystem[3][3], double IntersectionCoord[3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:605</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_aeff6a1ccab096f8951610964c6b0727e"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#aeff6a1ccab096f8951610964c6b0727e">Kratos::GeometryFunctions::UpdateOrientation</a></div><div class="ttdeci">static void UpdateOrientation(array_1d&lt; double, 3 &gt; &amp;EulerAngles, Quaternion&lt; double &gt; &amp;Orientation, const array_1d&lt; double, 3 &gt; &amp;DeltaRotation)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:800</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_afa1405629ee9c79223f163b606151df1"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afa1405629ee9c79223f163b606151df1">Kratos::GeometryFunctions::TriAngleArea</a></div><div class="ttdeci">static void TriAngleArea(double Coord1[3], double Coord2[3], double Coord3[3], double &amp;area)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:1591</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_afb4178f7aa038bd0ed82d2a4b3bf4906"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afb4178f7aa038bd0ed82d2a4b3bf4906">Kratos::GeometryFunctions::min</a></div><div class="ttdeci">static double min(double a, double b)</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:71</div></div>
<div class="ttc" id="anamespace_kratos_1_1_geometry_functions_html_afcfb83ddbb3c0ece824748b9b2e1c7fa"><div class="ttname"><a href="../../d4/d8c/namespace_kratos_1_1_geometry_functions.html#afcfb83ddbb3c0ece824748b9b2e1c7fa">Kratos::GeometryFunctions::VectorGlobal2Local</a></div><div class="ttdeci">static void VectorGlobal2Local(const double LocalCoordSystem[3][3], const double GlobalVector[3], double LocalVector[3])</div><div class="ttdef"><b>Definition:</b> GeometryFunctions.h:148</div></div>
<div class="ttc" id="anamespace_kratos_1_1_globals_html_ae57da311aaf349aa883363f673e534fc"><div class="ttname"><a href="../../d5/dc0/namespace_kratos_1_1_globals.html#ae57da311aaf349aa883363f673e534fc">Kratos::Globals::Pi</a></div><div class="ttdeci">constexpr double Pi</div><div class="ttdef"><b>Definition:</b> global_variables.h:30</div></div>
<div class="ttc" id="anamespace_kratos_html"><div class="ttname"><a href="../../db/d66/namespace_kratos.html">Kratos</a></div><div class="ttdoc">REF: G. R. Cowper, GAUSSIAN QUADRATURE FORMULAS FOR TRIANGLES.</div><div class="ttdef"><b>Definition:</b> mesh_condition.cpp:21</div></div>
<div class="ttc" id="anamespace_kratos_html_a0060702fbd6c7d45c773436101c9ded3"><div class="ttname"><a href="../../db/d66/namespace_kratos.html#a0060702fbd6c7d45c773436101c9ded3">Kratos::ZeroVector</a></div><div class="ttdeci">KratosZeroVector&lt; double &gt; ZeroVector</div><div class="ttdef"><b>Definition:</b> amatrix_interface.h:561</div></div>
<div class="ttc" id="anamespace_kratos_html_a06636285a2ff340ad99c42a94bb6a0ea"><div class="ttname"><a href="../../db/d66/namespace_kratos.html#a06636285a2ff340ad99c42a94bb6a0ea">Kratos::noalias</a></div><div class="ttdeci">T &amp; noalias(T &amp;TheMatrix)</div><div class="ttdef"><b>Definition:</b> amatrix_interface.h:484</div></div>
<div class="ttc" id="anamespace_kratos_html_a358df20da9726efb77013692eb628f08"><div class="ttname"><a href="../../db/d66/namespace_kratos.html#a358df20da9726efb77013692eb628f08">Kratos::ZeroMatrix</a></div><div class="ttdeci">KratosZeroMatrix&lt; double &gt; ZeroMatrix</div><div class="ttdef"><b>Definition:</b> amatrix_interface.h:559</div></div>
<div class="ttc" id="aopenmp__utils_8h_html"><div class="ttname"><a href="../../d1/db8/openmp__utils_8h.html">openmp_utils.h</a></div></div>
<div class="ttc" id="aquaternion_8h_html"><div class="ttname"><a href="../../da/d07/quaternion_8h.html">quaternion.h</a></div></div>
<div class="ttc" id="astructnode_html"><div class="ttname"><a href="../../d5/da1/structnode.html">node</a></div><div class="ttdef"><b>Definition:</b> mesh_converter.cpp:38</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Mar 2 2023 08:38:58 for KratosMultiphysics by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
